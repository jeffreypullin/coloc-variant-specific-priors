[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Home",
    "section": "",
    "text": "eQTL TSS analysis\nMethod testing"
  },
  {
    "objectID": "method-testing.html",
    "href": "method-testing.html",
    "title": "Method testing",
    "section": "",
    "text": "library(readr)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(patchwork)\nlibrary(tidyr)\n\n\nhg38_data &lt;- readRDS(\"/home/jp2045/coloc-estimated-eqtl-priors/data/tss-data/hg38-tss-data.rds\")\n\n\nplot_bfs &lt;- function(bfs, snps, tss = NULL, with_prior = FALSE) {\n \n  # Only take the first susie signal.\n  bfs &lt;- bfs[1, snps]\n  # Assume SNPS are in chr:bp format.\n  bps &lt;- vapply(strsplit(snps, \":\"), \\(x) as.numeric(x[[2]]), numeric(1))\n  \n  if (!is.null(tss) & with_prior) {\n    prior_vec &lt;- 10^-4 * length(bps) * coloc:::calculate_non_uniform_p(bps, tss)\n    bfs &lt;- bfs + log(prior_vec)\n  }\n  \n  p &lt;- tibble(bf = bfs, bp = bps) |&gt; \n    ggplot(aes(bp, bf)) + \n    geom_point()\n  \n  if (!is.null(tss)) {\n    p &lt;- p + geom_vline(xintercept = tss, colour = \"red\")\n  }\n  \n  p + \n    labs(x = \"\", y = \"BF\") + \n    theme_bw()\n}\n\nlookup_tss &lt;- function(trait) {\n  gene_id &lt;- unlist(strsplit(trait, \".\", fixed = TRUE))[[2]]\n  hg38_data |&gt; \n    filter(ensembl_gene_id == gene_id) |&gt; \n    pull(tss)\n}\n\n\nload(\"/rds/project/cew54/rds-cew54-basis/People/CHRIS/colocs_for_jeffrey.RData\")\ndevtools::load_all(\"~/coloc\")\n\n# 27 rows have 'too small overlap' warnings.\nmethod_comparison_data &lt;- COLOC |&gt; \n  # The BLUEPRINT Bayes factors are empty.\n  filter(!(substr(trait1, 1, 9) == \"BLUEPRINT\" | substr(trait2, 1, 9) == \"BLUEPRINT\")) |&gt; \n  as_tibble() |&gt; \n  mutate(\n    gene1 = grepl(\"ENSG\", trait1, fixed = TRUE),\n    gene2 = grepl(\"ENSG\", trait2, fixed = TRUE)\n  ) |&gt; \n  filter(gene1 | gene2) |&gt; \n  rowwise() |&gt; \n  # Assume that only 1 trait is an expression trait.\n  mutate(tss = ifelse(gene1, lookup_tss(trait1), lookup_tss(trait2))) |&gt; \n  select(trait1, trait2, block, tss, gene1) |&gt;\n  mutate(coloc_unif = list(coloc.bf_bf(BF[[block]][[trait1]], BF[[block]][[trait2]]))) |&gt; \n  mutate(coloc_non_unif = ifelse(\n    gene1, \n    list(coloc.bf_bf(BF[[block]][[trait1]], BF[[block]][[trait2]], tss1 = tss)), \n    list(coloc.bf_bf(BF[[block]][[trait1]], BF[[block]][[trait2]], tss2 = tss))\n  )) |&gt; \n  rowwise() |&gt; \n  mutate(h4_unif = list(coloc_unif$summary$PP.H4.abf)) |&gt; \n  mutate(h4_non_unif = list(coloc_non_unif$summary$PP.H4.abf)) |&gt; \n  filter(!any(is.na(h4_unif))) |&gt; \n  filter(!any(is.na(h4_non_unif)))\n\n\nmethod_comparison_data |&gt; \n  mutate(\n    h4_non_unif = max(h4_non_unif), \n    h4_unif = max(h4_unif)\n  ) |&gt; \n  ggplot(aes(h4_unif, h4_non_unif)) + \n  geom_point() + \n  geom_segment(aes(xend = h4_unif, yend = h4_unif), color = \"grey\") +\n  geom_abline(col = \"grey\") + \n  labs(\n    x = \"H4: Uniform priors\", \n    y = \"H4: Non-uniform priors\"\n  ) + \n  theme_bw()\n\n\n\n\n\nmethod_comparison_data |&gt; \n  mutate(\n    h4_non_unif = max(h4_non_unif), \n    h4_unif = max(h4_unif)\n  ) |&gt; \n  filter(h4_unif &lt;= 0.6 & h4_non_unif &gt; 0.6)\n\n# A tibble: 2 × 9\n# Rowwise: \n  trait1           trait2 block    tss gene1 coloc_unif   coloc_non_unif h4_unif\n  &lt;chr&gt;            &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;lgl&gt; &lt;list&gt;       &lt;list&gt;           &lt;dbl&gt;\n1 ASTCO_Ferreira_… Schmi… chr2… 1.98e8 FALSE &lt;named list&gt; &lt;named list&gt;     0.513\n2 Bossini-Castill… VIT_J… chr4… 1.01e8 TRUE  &lt;named list&gt; &lt;named list&gt;     0.590\n# ℹ 1 more variable: h4_non_unif &lt;dbl&gt;\n\n\n\nmethod_comparison_data |&gt; \n  mutate(\n    h4_non_unif = max(h4_non_unif), \n    h4_unif = max(h4_unif)\n  ) |&gt;  \n  mutate(h4_diff = h4_unif - h4_non_unif) |&gt; \n  ggplot(aes(h4_diff)) + \n  geom_histogram(binwidth = 0.005)\n\n\n\n\n\nmethod_comparison_data |&gt; \n  mutate(\n    h4_non_unif = max(h4_non_unif), \n    h4_unif = max(h4_unif)\n  ) |&gt;  \n  mutate(h4_diff = h4_unif - h4_non_unif) |&gt; \n  mutate(abs_h4_diff = abs(h4_diff)) |&gt; \n  arrange(desc(abs_h4_diff)) |&gt; \n  select(trait1, trait2, h4_unif, h4_non_unif)\n\n# A tibble: 117 × 4\n# Rowwise: \n   trait1                                             trait2 h4_unif h4_non_unif\n   &lt;chr&gt;                                              &lt;chr&gt;    &lt;dbl&gt;       &lt;dbl&gt;\n 1 CCL19_Zhao_37563310_1-hg38.tsv.gz                  GENCO…   0.805     0.416  \n 2 CD_DeLange_28067908_1-hg38.tsv.gz                  GTEx_…   0.283     0.110  \n 3 AITD_Saevarsdottir_32581359_1-hg38.tsv.gz          Quach…   0.159     0.00121\n 4 Schmiedel_2018_ge_CD8_T-cell_naive.ENSG00000279873 UC_De…   0.413     0.262  \n 5 Alasoo_2018_ge_macrophage_naive.ENSG00000138031    CD_De…   0.281     0.136  \n 6 Lepik_2017_ge_blood.ENSG00000234936                UC_De…   0.240     0.368  \n 7 Bossini-Castillo_2019_ge_Treg_naive.ENSG000002545… VIT_J…   0.590     0.705  \n 8 Nedelec_2016_ge_macrophage_naive.ENSG00000234936   UC_De…   0.278     0.392  \n 9 Quach_2016_ge_monocyte_Pam3CSK4.ENSG00000239445    TWEAK…   0.691     0.798  \n10 ASTCO_Ferreira_30929738_1-hg38.tsv.gz              Schmi…   0.513     0.613  \n# ℹ 107 more rows\n\n\nLower Pr(H4) with the non-uniform priors.\n\nsnps1 &lt;- colnames(BF[[\"chr3_block79\"]][[\"CCL19_Zhao_37563310_1-hg38.tsv.gz\"]])\nsnps2 &lt;- colnames(BF[[\"chr3_block79\"]][[\"GENCORD_ge_fibroblast.ENSG00000113971\"]])\nisnps &lt;- intersect(snps1, snps2)\nhg38_data |&gt; \n  filter(ensembl_gene_id == \"ENSG00000113971\")\n\n# A tibble: 1 × 2\n  ensembl_gene_id       tss\n  &lt;chr&gt;               &lt;dbl&gt;\n1 ENSG00000113971 132721707\n\nplot_bfs(BF[[\"chr3_block79\"]][[\"CCL19_Zhao_37563310_1-hg38.tsv.gz\"]], isnps) + \n plot_bfs(BF[[\"chr3_block79\"]][[\"GENCORD_ge_fibroblast.ENSG00000113971\"]], isnps, \n          tss = 132721707)  \n\n\n\n\nHigher Pr(H4) with the non-uniform priors.\n\nsnps1 &lt;- colnames(BF[[\"chr2_block25\"]][[\"Lepik_2017_ge_blood.ENSG00000234936\"]])\nsnps2 &lt;- colnames(BF[[\"chr2_block25\"]][[\"UC_DeLange_28067908_1-hg38.tsv.gz\"]])\nisnps &lt;- intersect(snps1, snps2)\nhg38_data |&gt; \n  filter(ensembl_gene_id == \"ENSG00000234936\")\n\n# A tibble: 1 × 2\n  ensembl_gene_id      tss\n  &lt;chr&gt;              &lt;dbl&gt;\n1 ENSG00000234936 43229573\n\nplot_bfs(BF[[\"chr2_block25\"]][[\"Lepik_2017_ge_blood.ENSG00000234936\"]], isnps) + \n plot_bfs(BF[[\"chr2_block25\"]][[\"UC_DeLange_28067908_1-hg38.tsv.gz\"]], isnps, \n          tss = 43229573)  \n\n\n\n\nNo change, high Pr(H4)\n\nsnps1 &lt;- colnames(BF[[\"chr2_block130\"]][[\"GENCORD_ge_T-cell.ENSG00000115009\"]])\nsnps2 &lt;- colnames(BF[[\"chr2_block130\"]][[\"ASTCO_Ferreira_30929738_1-hg38.tsv.gz\"]])\nisnps &lt;- intersect(snps1, snps2)\nhg38_data |&gt; \n  filter(ensembl_gene_id == \"ENSG00000115009\")\n\n# A tibble: 1 × 2\n  ensembl_gene_id        tss\n  &lt;chr&gt;                &lt;dbl&gt;\n1 ENSG00000115009 227813842.\n\nplot_bfs(BF[[\"chr2_block130\"]][[\"GENCORD_ge_T-cell.ENSG00000115009\"]], isnps) + \n plot_bfs(BF[[\"chr2_block130\"]][[\"ASTCO_Ferreira_30929738_1-hg38.tsv.gz\"]], isnps, \n          tss = 227813842)  \n\n\n\ncoloc.bf_bf(BF[[\"chr2_block130\"]][[\"GENCORD_ge_T-cell.ENSG00000115009\"]], \n            BF[[\"chr2_block130\"]][[\"ASTCO_Ferreira_30929738_1-hg38.tsv.gz\"]])\n\n[1]  0.00000 47.69470 23.43838 70.73193 76.24038\n[1]  0.000000 47.694696  6.276006 53.970702 43.022315\n\n\n$summary\n   nsnps        hit1        hit2    PP.H0.abf    PP.H1.abf    PP.H2.abf\n1:  4740 2:227805859 2:227805721 7.717351e-34 3.990357e-13 1.165810e-23\n2:  4740 2:227805859 2:227887158 3.630766e-24 1.877335e-03 1.930336e-21\n     PP.H3.abf    PP.H4.abf idx1 idx2\n1: 0.004036047 9.959640e-01    1    1\n2: 0.998105112 1.755304e-05    1    2\n\n$results\n              snp SNP.PP.H4.row1 SNP.PP.H4.row2\n   1: 2:227255202   5.168946e-41   1.841991e-26\n   2: 2:227255590   2.176152e-40   7.074883e-26\n   3: 2:227255715   7.856732e-40   3.204067e-25\n   4: 2:227256084   1.021424e-40   8.640170e-26\n   5: 2:227256385   1.061989e-38   5.376830e-25\n  ---                                          \n4736: 2:228505642   6.660958e-41   2.373914e-26\n4737: 2:228505810   4.590501e-41   2.082161e-26\n4738: 2:228505829   6.031528e-41   2.368550e-26\n4739: 2:228505851   5.050344e-41   1.859417e-26\n4740: 2:228506071   4.461520e-40   1.666774e-25\n\n$priors\n   p1    p2   p12 \n1e-04 1e-04 5e-06 \n\ncoloc.bf_bf(BF[[\"chr2_block130\"]][[\"GENCORD_ge_T-cell.ENSG00000115009\"]], \n            BF[[\"chr2_block130\"]][[\"ASTCO_Ferreira_30929738_1-hg38.tsv.gz\"]], \n            tss2 = 227813842)\n\n[1]  0.00000 47.69470 26.26311 73.55611 79.06624\n[1]  0.000000 47.694696  7.794885 55.489582 45.845926\n\n\n$summary\n   nsnps        hit1        hit2    PP.H0.abf    PP.H1.abf    PP.H2.abf\n1:  4740 2:227805859 2:227805721 4.573163e-35 2.364614e-14 1.164508e-23\n2:  4740 2:227805859 2:227887158 7.961115e-25 4.116398e-04 1.933079e-21\n     PP.H3.abf    PP.H4.abf idx1 idx2\n1: 0.004029298 9.959707e-01    1    1\n2: 0.999523555 6.480471e-05    1    2\n\n$results\n              snp SNP.PP.H4.row1 SNP.PP.H4.row2\n   1: 2:227255202   5.168946e-41   1.841991e-26\n   2: 2:227255590   2.176152e-40   7.074883e-26\n   3: 2:227255715   7.856732e-40   3.204067e-25\n   4: 2:227256084   1.021424e-40   8.640170e-26\n   5: 2:227256385   1.061989e-38   5.376830e-25\n  ---                                          \n4736: 2:228505642   6.660958e-41   2.373914e-26\n4737: 2:228505810   4.590501e-41   2.082161e-26\n4738: 2:228505829   6.031528e-41   2.368550e-26\n4739: 2:228505851   5.050344e-41   1.859417e-26\n4740: 2:228506071   4.461520e-40   1.666774e-25\n\n$priors\n   p1    p2   p12 \n1e-04 1e-04 5e-06 \n\n\nQ: How to you make the ultimate colocalisation? Is the ‘sharpness’ of the peak important?"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html",
    "href": "eqtl-tss-distance-analysis.html",
    "title": "eQTL distribution analysis",
    "section": "",
    "text": "library(readr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(tools)\nlibrary(forcats)\nlibrary(janitor)\nlibrary(ggupset)\nlibrary(purrr)\nlibrary(dplyr, warn.conflicts = FALSE)\n\nsource(here::here(\"code\", \"plot-utils.R\"))\n\nconflicted::conflict_prefer(\"select\", \"dplyr\")\nconflicted::conflict_prefer(\"filter\", \"dplyr\")\neqtl_catalogue_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"eqtl-catalogue.rds\"))\ngtex_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"gtex.rds\"))\nadipos_express_marignal_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"adipos-express-marginal.rds\"))\neqtlgen_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"eqtlgen.rds\"))\nonek1k_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"onek1k.rds\"))"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#eqtl-catalouge",
    "href": "eqtl-tss-distance-analysis.html#eqtl-catalouge",
    "title": "eQTL distribution analysis",
    "section": "eQTL catalouge",
    "text": "eQTL catalouge\n\neqtl_catalogue_data |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(file, abs_tss_distance, fill = study_label)) +\n  geom_boxplot(outlier.alpha = 0.1) +\n  coord_flip() +\n  labs(\n    x = \"eQTL catalogue datasets\",\n    y = \"Distance from the TSS (bp)\",\n    fill = \"Study\"\n  ) +\n  theme_jp_vgrid() + \n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        legend.position = \"right\", \n        legend.text = element_text(size = 14))\n\nWarning: Removed 18 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\neqtl_catalogue_data |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  summarise(abs_tss_distance = median(abs_tss_distance), \n            .by = c(file, sample_size, study_label)) |&gt;\n  ggplot(aes(sample_size, abs_tss_distance, colour = study_label)) +\n  geom_point(size = 3) +\n  labs(\n    x = \"Study sample size\",\n    y = \"Median distance to TSS\", \n    colour = \"Study\"\n  ) +\n  theme_jp() + \n  theme(axis.text = element_text(size = 10), \n        legend.position = \"right\", \n        legend.text = element_text(size = 14))"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#gtex",
    "href": "eqtl-tss-distance-analysis.html#gtex",
    "title": "eQTL distribution analysis",
    "section": "GTEx",
    "text": "GTEx\n\ngtex_data |&gt;\n  mutate(tissue = fct_rev(factor(tissue))) |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;  \n  ggplot(aes(tissue, abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Tissue\",\n    y = \"Distance to TSS\"\n  ) +\n  coord_flip() +\n  theme_jp_vgrid() + \n  theme(axis.text = element_text(size = 8))\n\nWarning: Removed 56 rows containing non-finite values (`stat_boxplot()`)."
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#adipoexpress-marginal",
    "href": "eqtl-tss-distance-analysis.html#adipoexpress-marginal",
    "title": "eQTL distribution analysis",
    "section": "AdipoExpress marginal",
    "text": "AdipoExpress marginal\n\nadipos_express_marignal_data |&gt; \n  ggplot(aes(file, abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Chromosome\",\n    y = \"Distance to TSS\"\n  ) +\n  coord_flip() +\n  theme_bw()"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#onek1k",
    "href": "eqtl-tss-distance-analysis.html#onek1k",
    "title": "eQTL distribution analysis",
    "section": "Onek1k",
    "text": "Onek1k\n\nBy combination of cell types\n\ncombination_onek1k_data &lt;- onek1k_data |&gt; \n  summarise(cell_type_collapsed = paste0(sort(unlist(cell_type)), collapse=\"-\"),\n            .by = c(gene_id, abs_tss_distance, round))\n\nmost_common_cell_types &lt;- combination_onek1k_data |&gt; \n  count(cell_type_collapsed) |&gt; \n  arrange(desc(n)) |&gt; \n  slice_head(n = 30) |&gt; \n  pull(cell_type_collapsed)\n\nsingle_cell_types &lt;- keep(most_common_cell_types, \n                          \\(x) !grepl(\"-\", x, fixed = TRUE))\n\ncombination_onek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  filter(cell_type_collapsed %in% most_common_cell_types) |&gt; \n  mutate(cell_type_collapsed = fct_reorder(\n    factor(cell_type_collapsed), \n    abs_tss_distance, \n    .desc = TRUE)\n  ) |&gt; \n  ggplot(aes(x = cell_type_collapsed, y = abs_tss_distance)) +\n  geom_boxplot() + \n  axis_combmatrix(sep = \"-\", levels = single_cell_types) + \n  labs(\n    x = \"\", \n    y = \"log(10) abs tss distance\"\n  ) + \n  theme_jp() + \n  theme(axis.text = element_text(size = 12), \n        axis.title.y = element_text(vjust=-30))\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\n\nBy individual cell type\n\nonek1k_data |&gt; \n  filter(n_cell_types == 1) |&gt; \n  mutate(cell_type = unlist(cell_type)) |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;\n  mutate(cell_type = fct_reorder(factor(cell_type), abs_tss_distance)) |&gt; \n  ggplot(aes(cell_type, abs_tss_distance)) + \n  geom_boxplot() + \n  coord_flip() + \n  labs(\n    y = \"Distance\", \n    x = \"Cell type\"\n  ) +\n  theme_jp_vgrid() + \n  theme(axis.text = element_text(size = 10))\n\n\n\n\n\n\nBy number of cell types for eQTL\n\nonek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;\n  ggplot(aes(factor(n_cell_types), abs_tss_distance)) +\n  geom_boxplot(outlier.alpha = 0.1) +\n  labs(\n    x = \"Number of cell types with eQTL\",\n    y = \"Distance of eQTL SNP to eGene TSS (log10 bp)\",\n  ) +\n  theme_jp()\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data |&gt; \n  ggplot(aes(factor(n_cell_types))) +\n  geom_bar() +\n  labs(\n    x = \"Number of cell types with eQTL\",\n    y = \"Number of eQTL-eGene pairs\",\n  ) +\n  theme_jp()\n\n\n\n\n\n\nBy round of conditional analysis\n\nonek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(factor(round), abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Round of conditional analysis\",\n    y = \"Distance of eQTL variant to eGene TSS (log10 bp)\",\n  ) +\n  theme_jp()\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data |&gt; \n  ggplot(aes(factor(round))) +\n  geom_bar() +\n  labs(\n    x = \"Round\",\n    y = \"Number of eQTL-eGene pairs\",\n  ) +\n  theme_jp()"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#across-studies",
    "href": "eqtl-tss-distance-analysis.html#across-studies",
    "title": "eQTL distribution analysis",
    "section": "Across studies",
    "text": "Across studies\n\nbind_rows(\n  gtex_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"GTX v8\"),\n  eqtlgen_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"eQTLGen\"),\n  eqtl_catalogue_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"eQTL Catalogue\"),\n  adipos_express_marignal_data |&gt; \n    select(abs_tss_distance) |&gt; \n    mutate(study = \"AdiposExpress\\n (Marginal)\"),\n  onek1k_data |&gt; \n    filter(round == 1) |&gt;\n    select(abs_tss_distance) |&gt; \n    mutate(study = \"OneK1K\")\n) |&gt;\n  mutate(log10_abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(study, log10_abs_tss_distance)) +\n  geom_violin(fill = \"grey\") +\n  geom_boxplot(outlier.alpha = 0.1) +\n  labs(\n    x = \"Study\",\n    y = \"Absolute Log(10) distance from variant to TSS\",\n  ) +\n  coord_flip() +\n  theme_jp_vgrid()\n\nWarning: Removed 76 rows containing non-finite values (`stat_ydensity()`).\n\n\nWarning: Removed 76 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data\n\n# A tibble: 6,749 × 9\n   gene_id         tss_distance round cell_type_collapsed cell_type n_cell_types\n   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;list&gt;           &lt;int&gt;\n 1 ENSG00000001561      -30457      1 Natural Killer Cell &lt;chr [1]&gt;            1\n 2 ENSG00000001561      731144      2 Dendritic Cell      &lt;chr [1]&gt;            1\n 3 ENSG00000002549       -6032.     1 Classic Monocyte    &lt;chr [1]&gt;            1\n 4 ENSG00000002549        5396.     1 Non-classic Monocy… &lt;chr [1]&gt;            1\n 5 ENSG00000002822     -307020      1 CD8 Effector memory &lt;chr [1]&gt;            1\n 6 ENSG00000002822     -243222      1 Non-classic Monocy… &lt;chr [1]&gt;            1\n 7 ENSG00000002822     -195349      1 Natural Killer Cell &lt;chr [1]&gt;            1\n 8 ENSG00000002919      -32379      1 CD8 Effector memory &lt;chr [1]&gt;            1\n 9 ENSG00000002933      -21895      1 Non-classic Monocy… &lt;chr [1]&gt;            1\n10 ENSG00000002933      -21895      2 Dendritic Cell      &lt;chr [1]&gt;            1\n# ℹ 6,739 more rows\n# ℹ 3 more variables: abs_tss_distance &lt;dbl&gt;, log10_tss_distance &lt;dbl&gt;,\n#   log10_abs_tss_distance &lt;dbl&gt;\n\nonek1k_data |&gt; \n  filter(abs(tss_distance) &lt;= 150000) |&gt; \n  ggplot(aes(tss_distance)) + \n  geom_density(bw = \"SJ\") + \n  facet_wrap(~ round) \n\n\n\n\n\ndens &lt;- eqtlgen_data |&gt; \n  filter(abs(tss_distance) &lt;= 300000) |&gt; \n  pull(tss_distance) |&gt; \n  density(bw = \"SJ\")\n  \ndens_data &lt;- tibble(x = dens$x, y = dens$y)\n\nsaveRDS(dens_data, here::here(\"output\", \"data\", \"density.rds\"))\n\n\nlog10_dens &lt;- eqtlgen_data |&gt; \n  filter(log10_abs_tss_distance &lt;= log10(300000)) |&gt; \n  filter(log10_abs_tss_distance &gt; 1) |&gt; \n  pull(log10_abs_tss_distance) |&gt; \n  density(bw = \"SJ\")\n\n\nall_studies_data &lt;- bind_rows(\n gtex_data |&gt;\n    mutate(study = \"GTX v8\"),\n  eqtlgen_data |&gt;\n    mutate(study = \"eQTLGen\"),\n  eqtl_catalogue_data |&gt;\n    mutate(study = \"eQTL Catalogue\"),\n  onek1k_data |&gt; \n    filter(round == 1) |&gt;\n    mutate(study = \"OneK1K\")\n)\n\n\nall_studies_data |&gt; \n  filter(abs(tss_distance) &lt;= 100000) |&gt; \n  mutate(kb = tss_distance / 1000) |&gt; \n  ggplot(aes(kb)) + \n  geom_density(bw = \"SJ\") + \n  facet_wrap(~ study, scales = \"free_y\") + \n  theme_jp() + \n  labs(\n    y = \"\",\n    x = \"Distance to TSS (kb)\"\n  ) + \n  theme(\n    axis.text = element_text(size = 12), \n    axis.title = element_text(size = 16),\n    strip.text = element_text(size = 20, hjust = 0)\n  )"
  }
]