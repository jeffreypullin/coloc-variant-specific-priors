[
  {
    "objectID": "eqtl-tss-distance-analysis.html",
    "href": "eqtl-tss-distance-analysis.html",
    "title": "eQTL distribution analysis",
    "section": "",
    "text": "library(readr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(tools)\nlibrary(forcats)\nlibrary(janitor)\nlibrary(ggupset)\nlibrary(purrr)\nlibrary(dplyr, warn.conflicts = FALSE)\n\nsource(here::here(\"code\", \"plot-utils.R\"))\n\nconflicted::conflict_prefer(\"select\", \"dplyr\")\nconflicted::conflict_prefer(\"filter\", \"dplyr\")\neqtl_catalogue_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"eqtl-catalogue.rds\"))\ngtex_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"gtex.rds\"))\nadipos_express_marignal_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"adipos-express-marginal.rds\"))\neqtlgen_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"eqtlgen.rds\"))\nonek1k_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"onek1k.rds\"))"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#eqtl-catalouge",
    "href": "eqtl-tss-distance-analysis.html#eqtl-catalouge",
    "title": "eQTL distribution analysis",
    "section": "eQTL catalouge",
    "text": "eQTL catalouge\n\neqtl_catalogue_data |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(file, abs_tss_distance, fill = study_label)) +\n  geom_boxplot(outlier.alpha = 0.1) +\n  coord_flip() +\n  labs(\n    x = \"eQTL catalogue datasets\",\n    y = \"Distance from the TSS (bp)\",\n    fill = \"Study\"\n  ) +\n  theme_jp_vgrid() + \n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        legend.position = \"right\", \n        legend.text = element_text(size = 14))\n\nWarning: Removed 18 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\neqtl_catalogue_data |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  summarise(abs_tss_distance = median(abs_tss_distance), \n            .by = c(file, sample_size, study_label)) |&gt;\n  ggplot(aes(sample_size, abs_tss_distance, colour = study_label)) +\n  geom_point(size = 3) +\n  labs(\n    x = \"Study sample size\",\n    y = \"Median distance to TSS\", \n    colour = \"Study\"\n  ) +\n  theme_jp() + \n  theme(axis.text = element_text(size = 10), \n        legend.position = \"right\", \n        legend.text = element_text(size = 14))"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#gtex",
    "href": "eqtl-tss-distance-analysis.html#gtex",
    "title": "eQTL distribution analysis",
    "section": "GTEx",
    "text": "GTEx\n\ngtex_data |&gt;\n  mutate(tissue = fct_rev(factor(tissue))) |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;  \n  ggplot(aes(tissue, abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Tissue\",\n    y = \"Distance to TSS\"\n  ) +\n  coord_flip() +\n  theme_jp_vgrid() + \n  theme(axis.text = element_text(size = 8))\n\nWarning: Removed 56 rows containing non-finite values (`stat_boxplot()`)."
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#adipoexpress-marginal",
    "href": "eqtl-tss-distance-analysis.html#adipoexpress-marginal",
    "title": "eQTL distribution analysis",
    "section": "AdipoExpress marginal",
    "text": "AdipoExpress marginal\n\nadipos_express_marignal_data |&gt; \n  ggplot(aes(file, abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Chromosome\",\n    y = \"Distance to TSS\"\n  ) +\n  coord_flip() +\n  theme_bw()"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#onek1k",
    "href": "eqtl-tss-distance-analysis.html#onek1k",
    "title": "eQTL distribution analysis",
    "section": "Onek1k",
    "text": "Onek1k\n\nBy combination of cell types\n\ncombination_onek1k_data &lt;- onek1k_data |&gt; \n  summarise(cell_type_collapsed = paste0(sort(unlist(cell_type)), collapse=\"-\"),\n            .by = c(gene_id, abs_tss_distance, round))\n\nmost_common_cell_types &lt;- combination_onek1k_data |&gt; \n  count(cell_type_collapsed) |&gt; \n  arrange(desc(n)) |&gt; \n  slice_head(n = 30) |&gt; \n  pull(cell_type_collapsed)\n\nsingle_cell_types &lt;- keep(most_common_cell_types, \n                          \\(x) !grepl(\"-\", x, fixed = TRUE))\n\ncombination_onek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  filter(cell_type_collapsed %in% most_common_cell_types) |&gt; \n  mutate(cell_type_collapsed = fct_reorder(\n    factor(cell_type_collapsed), \n    abs_tss_distance, \n    .desc = TRUE)\n  ) |&gt; \n  ggplot(aes(x = cell_type_collapsed, y = abs_tss_distance)) +\n  geom_boxplot() + \n  axis_combmatrix(sep = \"-\", levels = single_cell_types) + \n  labs(\n    x = \"\", \n    y = \"log(10) abs tss distance\"\n  ) + \n  theme_jp() + \n  theme(axis.text = element_text(size = 12), \n        axis.title.y = element_text(vjust=-30))\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\n\nBy individual cell type\n\nonek1k_data |&gt; \n  filter(n_cell_types == 1) |&gt; \n  mutate(cell_type = unlist(cell_type)) |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;\n  mutate(cell_type = fct_reorder(factor(cell_type), abs_tss_distance)) |&gt; \n  ggplot(aes(cell_type, abs_tss_distance)) + \n  geom_boxplot() + \n  coord_flip() + \n  labs(\n    y = \"Distance\", \n    x = \"Cell type\"\n  ) +\n  theme_jp_vgrid() + \n  theme(axis.text = element_text(size = 10))\n\n\n\n\n\n\nBy number of cell types for eQTL\n\nonek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;\n  ggplot(aes(factor(n_cell_types), abs_tss_distance)) +\n  geom_boxplot(outlier.alpha = 0.1) +\n  labs(\n    x = \"Number of cell types with eQTL\",\n    y = \"Distance of eQTL SNP to eGene TSS (log10 bp)\",\n  ) +\n  theme_jp()\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data |&gt; \n  ggplot(aes(factor(n_cell_types))) +\n  geom_bar() +\n  labs(\n    x = \"Number of cell types with eQTL\",\n    y = \"Number of eQTL-eGene pairs\",\n  ) +\n  theme_jp()\n\n\n\n\n\n\nBy round of conditional analysis\n\nonek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(factor(round), abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Round of conditional analysis\",\n    y = \"Distance of eQTL variant to eGene TSS (log10 bp)\",\n  ) +\n  theme_jp()\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data |&gt; \n  ggplot(aes(factor(round))) +\n  geom_bar() +\n  labs(\n    x = \"Round\",\n    y = \"Number of eQTL-eGene pairs\",\n  ) +\n  theme_jp()"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#across-studies",
    "href": "eqtl-tss-distance-analysis.html#across-studies",
    "title": "eQTL distribution analysis",
    "section": "Across studies",
    "text": "Across studies\n\nbind_rows(\n  gtex_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"GTX v8\"),\n  eqtlgen_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"eQTLGen\"),\n  eqtl_catalogue_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"eQTL Catalogue\"),\n  adipos_express_marignal_data |&gt; \n    select(abs_tss_distance) |&gt; \n    mutate(study = \"AdiposExpress\\n (Marginal)\"),\n  onek1k_data |&gt; \n    filter(round == 1) |&gt;\n    select(abs_tss_distance) |&gt; \n    mutate(study = \"OneK1K\")\n) |&gt;\n  mutate(log10_abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(study, log10_abs_tss_distance)) +\n  geom_violin(fill = \"grey\") +\n  geom_boxplot(outlier.alpha = 0.1) +\n  labs(\n    x = \"Study\",\n    y = \"Absolute Log(10) distance from variant to TSS\",\n  ) +\n  coord_flip() +\n  theme_jp_vgrid()\n\nWarning: Removed 76 rows containing non-finite values (`stat_ydensity()`).\n\n\nWarning: Removed 76 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data\n\n# A tibble: 6,749 × 9\n   gene_id         tss_distance round cell_type_collapsed cell_type n_cell_types\n   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;list&gt;           &lt;int&gt;\n 1 ENSG00000001561      -30457      1 Natural Killer Cell &lt;chr [1]&gt;            1\n 2 ENSG00000001561      731144      2 Dendritic Cell      &lt;chr [1]&gt;            1\n 3 ENSG00000002549       -6032.     1 Classic Monocyte    &lt;chr [1]&gt;            1\n 4 ENSG00000002549        5396.     1 Non-classic Monocy… &lt;chr [1]&gt;            1\n 5 ENSG00000002822     -307020      1 CD8 Effector memory &lt;chr [1]&gt;            1\n 6 ENSG00000002822     -243222      1 Non-classic Monocy… &lt;chr [1]&gt;            1\n 7 ENSG00000002822     -195349      1 Natural Killer Cell &lt;chr [1]&gt;            1\n 8 ENSG00000002919      -32379      1 CD8 Effector memory &lt;chr [1]&gt;            1\n 9 ENSG00000002933      -21895      1 Non-classic Monocy… &lt;chr [1]&gt;            1\n10 ENSG00000002933      -21895      2 Dendritic Cell      &lt;chr [1]&gt;            1\n# ℹ 6,739 more rows\n# ℹ 3 more variables: abs_tss_distance &lt;dbl&gt;, log10_tss_distance &lt;dbl&gt;,\n#   log10_abs_tss_distance &lt;dbl&gt;\n\nonek1k_data |&gt; \n  filter(abs(tss_distance) &lt;= 150000) |&gt; \n  ggplot(aes(tss_distance)) + \n  geom_density(bw = \"SJ\") + \n  facet_wrap(~ round) \n\n\n\n\n\ndens &lt;- eqtlgen_data |&gt; \n  filter(abs(tss_distance) &lt;= 300000) |&gt; \n  pull(tss_distance) |&gt; \n  density(bw = \"SJ\")\n  \ndens_data &lt;- tibble(x = dens$x, y = dens$y)\n\nsaveRDS(dens_data, here::here(\"output\", \"data\", \"density.rds\"))\n\n\nlog10_dens &lt;- eqtlgen_data |&gt; \n  filter(log10_abs_tss_distance &lt;= log10(300000)) |&gt; \n  filter(log10_abs_tss_distance &gt; 1) |&gt; \n  pull(log10_abs_tss_distance) |&gt; \n  density(bw = \"SJ\")\n\n\nall_studies_data &lt;- bind_rows(\n gtex_data |&gt;\n    mutate(study = \"GTX v8\"),\n  eqtlgen_data |&gt;\n    mutate(study = \"eQTLGen\"),\n  eqtl_catalogue_data |&gt;\n    mutate(study = \"eQTL Catalogue\"),\n  onek1k_data |&gt; \n    filter(round == 1) |&gt;\n    mutate(study = \"OneK1K\")\n)\n\n\nall_studies_data |&gt; \n  filter(abs(tss_distance) &lt;= 100000) |&gt; \n  mutate(kb = tss_distance / 1000) |&gt; \n  ggplot(aes(kb)) + \n  geom_density(bw = \"SJ\") + \n  facet_wrap(~ study, scales = \"free_y\") + \n  theme_jp() + \n  labs(\n    y = \"\",\n    x = \"Distance to TSS (kb)\"\n  ) + \n  theme(\n    axis.text = element_text(size = 12), \n    axis.title = element_text(size = 16),\n    strip.text = element_text(size = 20, hjust = 0)\n  )"
  },
  {
    "objectID": "pqtl-eqtl-coloc-analysis.html",
    "href": "pqtl-eqtl-coloc-analysis.html",
    "title": "pQTL-eQTL colocalisation analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(purrr)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(patchwork)\nlibrary(yaml)\nlibrary(forcats)\n\ndevtools::load_all(\"~/coloc\")\n\n\n# Load eQTL dataset IDs.\nconfig &lt;- read_yaml(here::here(\"config.yaml\"))\neqtl_data_ids &lt;- config$pqtl_eqtl_coloc_dataset_ids\neqtl_data_ids_lookup &lt;- c(\n  \"QTD000373\" = \"Lepik et. al. 2017\",\n  \"QTD000341\" = \"GTEx thyroid\",\n  \"QTD000116\" = \"GTEx adipose (subcutaneous)\",\n  \"QTD000021\" = \"BLUEPRINT Monocytes\",\n  \"QTD000539\" = \"TwinsUK LCL\"\n)\n\n# Load eQTL-pQTL colocalisation results.\npqtl_eqtl_colocs &lt;- expand_grid(\n  eqtl_data_id = eqtl_data_ids, \n  chr = 1:22\n) |&gt;\n  rowwise() |&gt;\n  mutate(file = paste0(\n    here::here(\"output/data/pqtl-eqtl-coloc\"), \"-\", eqtl_data_id, \"-\", chr, \".rds\")\n  ) |&gt;\n  mutate(data = list(read_rds(file))) |&gt;\n  unnest(data)\n\n# Load protein metadata.\nprotein_metadata &lt;- read_tsv(\n  here::here(\"data/metadata/SomaLogic_Ensembl_96_phenotype_metadata.tsv.gz\"), \n  show_col_types = FALSE\n)\n\n\ncoloc_level_data &lt;- left_join(\n  pqtl_eqtl_colocs |&gt;\n    select(eqtl_data_id, starts_with(\"PP.H4.abf\"), phenotype_id, \n           coloc_gene_id = gene_id), \n  protein_metadata |&gt;\n    select(coding_gene_id = gene_id, phenotype_id),\n  by = \"phenotype_id\"\n) |&gt;\n  rename(protein_id = phenotype_id) |&gt;\n  pivot_longer(-c(protein_id, coding_gene_id, eqtl_data_id, coloc_gene_id),\n               values_to = \"pp_h4\", \n               names_to = c(\"junk\", \"prior_type\"),\n               names_pattern = \"(.*?)_(.*)\") |&gt;\n  select(-junk) |&gt;\n  mutate(sig_coloc = pp_h4 &gt;= 0.8) |&gt;\n  mutate(gene_match = coding_gene_id == coloc_gene_id) |&gt;\n  summarise(\n    colocalised = any(sig_coloc), \n    is_tp = any(sig_coloc & gene_match),\n    is_fn = !any(sig_coloc & gene_match),\n    is_fp = any(sig_coloc) & !any(sig_coloc & gene_match),\n    .by = c(protein_id, prior_type, eqtl_data_id)\n  ) |&gt;\n  # FIXME: Monocyte issues with ABC score.\n  summarise(\n    n_colocalised = sum(colocalised, na.rm = TRUE),\n    n_tp = sum(is_tp, na.rm = TRUE),\n    n_fn = sum(is_fn, na.rm = TRUE),\n    n_fp = sum(is_fp, na.rm = TRUE),\n    .by = c(eqtl_data_id, prior_type)\n  ) |&gt;\n  mutate(\n    recall = n_tp / (n_tp + n_fn), \n    precision = n_tp / (n_tp + n_fp)\n  )\n\nprotein_level_data &lt;- left_join(\n  pqtl_eqtl_colocs |&gt;\n    select(eqtl_data_id, starts_with(\"PP.H4.abf\"), phenotype_id, \n           coloc_gene_id = gene_id), \n  protein_metadata |&gt;\n    select(coding_gene_id = gene_id, phenotype_id),\n  by = \"phenotype_id\"\n) |&gt;\n  rename(protein_id = phenotype_id) |&gt;\n  pivot_longer(-c(protein_id, coding_gene_id, eqtl_data_id, coloc_gene_id),\n               values_to = \"pp_h4\", \n               names_to = c(\"junk\", \"prior_type\"),\n               names_pattern = \"(.*?)_(.*)\") |&gt;\n  select(-junk) |&gt;\n  mutate(sig_coloc = pp_h4 &gt;= 0.8) |&gt;\n  mutate(gene_match = coding_gene_id == coloc_gene_id) |&gt;\n  summarise(\n    colocalised = any(sig_coloc), \n    is_tp = any(sig_coloc & gene_match),\n    is_fn = !any(sig_coloc & gene_match),\n    is_fp = any(sig_coloc) & !any(sig_coloc & gene_match),\n    .by = c(protein_id, prior_type, eqtl_data_id)\n  ) |&gt;\n  # FIXME: Monocyte issues with ABC score.\n  summarise(\n    n_colocalised = sum(colocalised, na.rm = TRUE),\n    n_tp = sum(is_tp, na.rm = TRUE),\n    n_fn = sum(is_fn, na.rm = TRUE),\n    n_fp = sum(is_fp, na.rm = TRUE),\n    .by = c(eqtl_data_id, prior_type)\n  ) |&gt; \n  mutate(\n    recall = n_tp / (n_tp + n_fn), \n    precision = n_tp / (n_tp + n_fp)\n  )\n\n\ncoloc_level_data\n\n# A tibble: 80 × 8\n   eqtl_data_id prior_type      n_colocalised  n_tp  n_fn  n_fp recall precision\n   &lt;chr&gt;        &lt;chr&gt;                   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;\n 1 QTD000373    unif                      128    90   444    38  0.169     0.703\n 2 QTD000373    eqtl_tss_onek1…           128    88   446    40  0.165     0.688\n 3 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 4 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 5 QTD000373    pqtl_tss_onek1…           133    92   442    41  0.172     0.692\n 6 QTD000373    eqtl_tss_pqtl_…           133    91   443    42  0.170     0.684\n 7 QTD000373    eqtl_tss_eqtlg…           127    87   447    40  0.163     0.685\n 8 QTD000373    pqtl_tss_eqtlg…           132    93   441    39  0.174     0.705\n 9 QTD000373    eqtl_tss_pqtl_…           132    90   444    42  0.169     0.682\n10 QTD000373    gnocchi_eqtl              127    88   446    39  0.165     0.693\n# ℹ 70 more rows\n\n\n\nprotein_level_data\n\n# A tibble: 80 × 8\n   eqtl_data_id prior_type      n_colocalised  n_tp  n_fn  n_fp recall precision\n   &lt;chr&gt;        &lt;chr&gt;                   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;\n 1 QTD000373    unif                      128    90   444    38  0.169     0.703\n 2 QTD000373    eqtl_tss_onek1…           128    88   446    40  0.165     0.688\n 3 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 4 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 5 QTD000373    pqtl_tss_onek1…           133    92   442    41  0.172     0.692\n 6 QTD000373    eqtl_tss_pqtl_…           133    91   443    42  0.170     0.684\n 7 QTD000373    eqtl_tss_eqtlg…           127    87   447    40  0.163     0.685\n 8 QTD000373    pqtl_tss_eqtlg…           132    93   441    39  0.174     0.705\n 9 QTD000373    eqtl_tss_pqtl_…           132    90   444    42  0.169     0.682\n10 QTD000373    gnocchi_eqtl              127    88   446    39  0.165     0.693\n# ℹ 70 more rows\n\n\n\ncoloc_level_data |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  mutate(eqtl_data_name = eqtl_data_ids_lookup[eqtl_data_id]) |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n  ) + \n  facet_wrap(~eqtl_data_name, scales = \"free\") + \n  theme_bw() + \n  theme(legend.position = \"none\")\n\nWarning: ggrepel: 7 unlabeled data points (too many overlaps). Consider increasing max.overlaps\nggrepel: 7 unlabeled data points (too many overlaps). Consider increasing max.overlaps\n\n\nWarning: ggrepel: 10 unlabeled data points (too many overlaps). Consider increasing max.overlaps\nggrepel: 10 unlabeled data points (too many overlaps). Consider increasing max.overlaps\n\n\nWarning: ggrepel: 9 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\ncoloc_level_data |&gt;\n  filter(eqtl_data_id == \"QTD000021\") |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n  ) + \n  theme_bw() + \n  theme(legend.position = \"none\")\n\n\n\n\n\ncoloc_level_data |&gt;\n  summarise(\n    recall = median(recall), \n    precision = median(precision), \n    .by = prior_type\n  ) |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n    title = \"Median over eQTL datasets\"\n  ) + \n  theme_bw() + \n  theme(legend.position= \"none\")\n\n\n\n\n\ncoloc_level_data |&gt;\n  mutate(eqtl_data_name = eqtl_data_ids_lookup[eqtl_data_id]) |&gt;\n  mutate(prior_type = fct_reorder(\n    factor(prior_type), \n    n_colocalised)\n  ) |&gt;\n  mutate(eqtl_data_name = fct_reorder(\n    factor(eqtl_data_name), \n    n_colocalised\n  )) |&gt;\n  ggplot(aes(prior_type, n_colocalised, fill = eqtl_data_name)) + \n  geom_col(position = \"dodge\") + \n  coord_flip() + \n  labs(\n    y = \"Number of signigicantly colocalised pQTL-eQTL pairs\",\n    x = \"Prior\"\n  ) + \n  theme_bw()\n\n\n\n\n\nprotein_level_data |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n  ) + \n  guides(col = \"none\") + \n  theme_bw()\n\nWarning: ggrepel: 67 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_eqtl_tss_eqtlgen)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw() + \npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_pqtl_tss_eqtlgen)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw()\n\n\n\n\n\npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_abc_score_eqtl)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw() + \npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_abc_score_pqtl)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw()\n\nWarning: Removed 5 rows containing missing values (`geom_point()`).\nRemoved 5 rows containing missing values (`geom_point()`).\n\n\n\n\n\nNo trend in which Pr(H4) are affected\n\npqtl_eqtl_colocs |&gt;\n  mutate(diff = PP.H4.abf_unif - PP.H4.abf_abc_score_pqtl) |&gt;\n  ggplot(aes(PP.H4.abf_unif , diff)) + \n  geom_point() + \n  coord_cartesian(ylim = c(-0.75, 0.75)) + \n  theme_bw()\n\nWarning: Removed 5 rows containing missing values (`geom_point()`).\n\n\n\n\n\nIn most cases adding the prior has little effect\n\npqtl_eqtl_colocs |&gt;\n  mutate(diff = abs(PP.H4.abf_unif - PP.H4.abf_abc_score_pqtl)) |&gt;\n  mutate(cut_diff = cut(diff, breaks = seq(0, 1, by = 0.05), \n                        include.lowest = TRUE)) |&gt;\n  count(cut_diff) |&gt;\n  mutate(prop = n / sum(n)) |&gt;\n  ggplot(aes(cut_diff, prop)) + \n  geom_col() + \n  labs(\n    x = \"Range of difference\", \n    y = \"Proportion\"\n  ) + \n  theme_bw()"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Home",
    "section": "",
    "text": "eQTL TSS distance analysis\nPrior visualisation\nGWAS-eQTL colocalisation analysis\npQTL-eQTL colocalisation analysis\nFine-mapping analysis\nSimulation analysis"
  },
  {
    "objectID": "finemapping-analysis.html",
    "href": "finemapping-analysis.html",
    "title": "Finemapping analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(forcats)\n\ndevtools::load_all(\"~/coloc\")\n\n\ncompute_credible_set &lt;- function(pips, alpha = 0.95) {\n  pips_order &lt;- order(pips, decreasing = TRUE)\n  cum_pips &lt;- cumsum(pips[pips_order])\n  cs_size &lt;- which.max(cum_pips &gt;= alpha) \n  pips_order[1:cs_size]\n}\n\n\ngwas_eqtl_finemapping &lt;- expand_grid(\n  chr = 1:22\n) |&gt;\n  rowwise() |&gt;\n  mutate(file = paste0(\n    here::here(\"output/data/gwas-eqtl-finemapping\"), \"-\", chr, \".rds\")\n  ) |&gt;\n  mutate(data = list(read_rds(file))) |&gt;\n  unnest(data)\n\n\ncs_n_data &lt;- gwas_eqtl_finemapping |&gt;\n  select(gene_name, ends_with(\"eqtl\"), ends_with(\"gwas\")) |&gt;\n  pivot_longer(-gene_name, values_to = \"pip\") |&gt;\n  summarise(cs = list(compute_credible_set(pip)), \n            .by = c(gene_name, name)) |&gt;\n  rowwise() |&gt;\n  mutate(cs_n = length(cs)) |&gt;\n  ungroup()\n\n\ncs_n_data |&gt;\n  mutate(name = fct_reorder(factor(name), cs_n)) |&gt;\n  ggplot(aes(name, log(cs_n))) + \n  geom_boxplot() + \n  coord_flip() +\n  theme_bw()\n\n\n\n\n\ncs_n_data |&gt;\n  mutate(single_cs = cs_n == 1) |&gt;\n  summarise(prop_single_cs = sum(single_cs) / n(), .by = name) |&gt;\n  mutate(name = fct_reorder(factor(name), prop_single_cs)) |&gt;\n  ggplot(aes(name, prop_single_cs)) + \n  geom_point() + \n  coord_flip() +\n  theme_bw()\n\n\n\n\n\ncs_n_data |&gt;\n  filter(cs_n &lt;= 20) |&gt;\n  count(cs_n, name) |&gt;\n  ggplot(aes(cs_n, n)) + \n  geom_col() + \n  labs(\n    y = \"Count\",\n    x = \"Size of single-causal variant CS\"\n  ) + \n  facet_wrap(~name) + \n  theme_bw()"
  },
  {
    "objectID": "gwas-eqtl-coloc-analysis.html",
    "href": "gwas-eqtl-coloc-analysis.html",
    "title": "GWAS-eQTL colocalisation analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(forcats)\nlibrary(yaml)\nlibrary(glue)\n\ndevtools::load_all(\"~/coloc\")\n\n\ngwas_eqtl_colocs &lt;- expand_grid(\n  chr = 1:22,\n  gwas_id_eqtl_id = c(\n    \"AUTOIMMUNE-QTD000373\", \"AUTOIMMUNE-QTD000341\", \"AUTOIMMUNE-QTD000499\", \"AUTOIMMUNE-QTD000021\", \"AUTOIMMUNE-QTD000031\"\n  )\n  ) |&gt;\n  separate_wider_delim(gwas_id_eqtl_id, \"-\", names = c(\"gwas_id\", \"eqtl_id\")) |&gt;\n  rowwise() |&gt;\n  mutate(file = here::here(\n    glue(\"output/data/gwas-eqtl-coloc-{gwas_id}-{eqtl_id}-{chr}.rds\")\n  )) |&gt;\n  mutate(data = list(read_rds(file))) |&gt;\n  unnest(data)\n\n\ngwas_eqtl_colocs |&gt;\n  filter(PP.H4.abf_unif &gt; 0.8) |&gt;\n  filter(locus_gene_name == coloc_gene_name) |&gt;\n  select(eqtl_id, locus_gene_name, coloc_gene_name, PP.H4.abf_unif) |&gt;\n  print(n = 80)\n\n# A tibble: 80 × 4\n   eqtl_id   locus_gene_name coloc_gene_name PP.H4.abf_unif\n   &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;                    &lt;dbl&gt;\n 1 QTD000373 MMEL1           MMEL1                    0.943\n 2 QTD000373 CEPT1           CEPT1                    0.991\n 3 QTD000373 DENND2D         DENND2D                  0.991\n 4 QTD000373 GPR25           GPR25                    0.885\n 5 QTD000341 MMEL1           MMEL1                    0.922\n 6 QTD000341 VAV3            VAV3                     0.999\n 7 QTD000499 MMEL1           MMEL1                    0.939\n 8 QTD000499 SLC66A1         SLC66A1                  0.865\n 9 QTD000021 MMEL1           MMEL1                    0.905\n10 QTD000021 FUBP1           FUBP1                    0.999\n11 QTD000031 MMEL1           MMEL1                    0.951\n12 QTD000031 TTC34           TTC34                    0.991\n13 QTD000031 SLC66A1         SLC66A1                  0.824\n14 QTD000031 DRAM2           DRAM2                    0.991\n15 QTD000031 CEPT1           CEPT1                    0.991\n16 QTD000031 DENND2D         DENND2D                  0.991\n17 QTD000373 PUS10           PUS10                    0.929\n18 QTD000373 C2orf74         C2orf74                  0.940\n19 QTD000373 PPIL3           PPIL3                    0.997\n20 QTD000341 TPO             TPO                      0.993\n21 QTD000341 C2orf74         C2orf74                  0.921\n22 QTD000341 ACTR1B          ACTR1B                   0.984\n23 QTD000341 PPIL3           PPIL3                    0.980\n24 QTD000499 PPIL3           PPIL3                    0.968\n25 QTD000021 ADCY3           ADCY3                    0.809\n26 QTD000021 PUS10           PUS10                    0.925\n27 QTD000021 ANKRD36         ANKRD36                  0.977\n28 QTD000021 ACTR1B          ACTR1B                   0.962\n29 QTD000021 PPIL3           PPIL3                    0.995\n30 QTD000031 PUS10           PUS10                    0.912\n31 QTD000031 ANKRD36         ANKRD36                  0.983\n32 QTD000031 ACTR1B          ACTR1B                   0.984\n33 QTD000031 TYW5            TYW5                     0.919\n34 QTD000031 PPIL3           PPIL3                    0.995\n35 QTD000373 ANKRD55         ANKRD55                  1.00 \n36 QTD000341 PDE8B           PDE8B                    0.990\n37 QTD000031 ANKRD55         ANKRD55                  1.00 \n38 QTD000021 H4C13           H4C13                    0.918\n39 QTD000031 H4C13           H4C13                    0.977\n40 QTD000031 BACH2           BACH2                    0.999\n41 QTD000373 IRF5            IRF5                     0.994\n42 QTD000341 IRF5            IRF5                     0.989\n43 QTD000021 IRF5            IRF5                     0.906\n44 QTD000341 RAB2A           RAB2A                    0.943\n45 QTD000499 RAB2A           RAB2A                    0.944\n46 QTD000341 RAB14           RAB14                    0.866\n47 QTD000341 NEK6            NEK6                     0.990\n48 QTD000021 TNFSF8          TNFSF8                   0.984\n49 QTD000021 TRAF1           TRAF1                    0.927\n50 QTD000373 SLC29A3         SLC29A3                  0.999\n51 QTD000341 NKX2-3          NKX2-3                   1.00 \n52 QTD000341 IRF7            IRF7                     0.900\n53 QTD000341 DRD4            DRD4                     0.838\n54 QTD000021 LMNTD2          LMNTD2                   0.968\n55 QTD000373 METTL7B         METTL7B                  0.944\n56 QTD000499 MARS1           MARS1                    0.980\n57 QTD000031 MARS1           MARS1                    0.889\n58 QTD000499 COG6            COG6                     0.942\n59 QTD000021 COG6            COG6                     0.974\n60 QTD000373 GINS2           GINS2                    0.808\n61 QTD000499 GINS2           GINS2                    0.890\n62 QTD000021 BRD7            BRD7                     0.884\n63 QTD000031 APOBR           APOBR                    0.998\n64 QTD000373 ACAP1           ACAP1                    0.997\n65 QTD000373 KCTD11          KCTD11                   0.997\n66 QTD000031 ACAP1           ACAP1                    0.997\n67 QTD000031 KCTD11          KCTD11                   0.997\n68 QTD000373 CD226           CD226                    0.989\n69 QTD000373 IQCN            IQCN                     0.976\n70 QTD000373 NTN5            NTN5                     0.911\n71 QTD000341 NTN5            NTN5                     0.909\n72 QTD000021 IQCN            IQCN                     0.975\n73 QTD000373 UBASH3A         UBASH3A                  0.954\n74 QTD000341 UBASH3A         UBASH3A                  0.954\n75 QTD000031 UBASH3A         UBASH3A                  0.954\n76 QTD000373 SYNGR1          SYNGR1                   0.906\n77 QTD000499 DDX17           DDX17                    0.981\n78 QTD000021 LIF             LIF                      0.998\n79 QTD000021 DDX17           DDX17                    0.920\n80 QTD000031 DDX17           DDX17                    0.962\n\n\n\ngwas_eqtl_colocs |&gt;\n  filter(PP.H4.abf_unif &gt; 0.8) |&gt;\n  filter(locus_gene_name == coloc_gene_name) |&gt;\n  summarise(n_eqtl_data_ids = n(), .by = locus_gene_name) |&gt;\n  arrange(desc(n_eqtl_data_ids)) |&gt;\n  print(n = 47)\n\n# A tibble: 47 × 2\n   locus_gene_name n_eqtl_data_ids\n   &lt;chr&gt;                     &lt;int&gt;\n 1 MMEL1                         5\n 2 PPIL3                         5\n 3 PUS10                         3\n 4 ACTR1B                        3\n 5 IRF5                          3\n 6 UBASH3A                       3\n 7 DDX17                         3\n 8 CEPT1                         2\n 9 DENND2D                       2\n10 SLC66A1                       2\n11 C2orf74                       2\n12 ANKRD36                       2\n13 ANKRD55                       2\n14 H4C13                         2\n15 RAB2A                         2\n16 MARS1                         2\n17 COG6                          2\n18 GINS2                         2\n19 ACAP1                         2\n20 KCTD11                        2\n21 IQCN                          2\n22 NTN5                          2\n23 GPR25                         1\n24 VAV3                          1\n25 FUBP1                         1\n26 TTC34                         1\n27 DRAM2                         1\n28 TPO                           1\n29 ADCY3                         1\n30 TYW5                          1\n31 PDE8B                         1\n32 BACH2                         1\n33 RAB14                         1\n34 NEK6                          1\n35 TNFSF8                        1\n36 TRAF1                         1\n37 SLC29A3                       1\n38 NKX2-3                        1\n39 IRF7                          1\n40 DRD4                          1\n41 LMNTD2                        1\n42 METTL7B                       1\n43 BRD7                          1\n44 APOBR                         1\n45 CD226                         1\n46 SYNGR1                        1\n47 LIF                           1\n\n\n\ngwas_eqtl_colocs |&gt;\n  filter(locus_gene_name == coloc_gene_name) |&gt;\n  select(locus_gene_name, gwas_id, starts_with(\"PP.H4.abf\")) |&gt;\n  pivot_longer(-c(locus_gene_name, gwas_id), values_to = \"pp_h4\") |&gt;\n  mutate(sig_coloc = pp_h4 &gt; 0.8) |&gt;\n  summarise(n_sig = sum(sig_coloc), .by = name) |&gt;\n  mutate(is_unif = name == \"PP.H4.abf_unif\") |&gt;\n  mutate(name = fct_reorder(factor(name), n_sig)) |&gt;\n  ggplot(aes(name, n_sig, fill = is_unif)) + \n  geom_col() + \n  coord_flip() + \n  labs(\n    y = \"Number of signifcant (&gt; 0.8) colocalisations\", \n    x = \"Prior type\"\n  ) +\n  theme_bw() + \n  theme(legend.position = \"none\")\n\n\n\n\n\ngwas_eqtl_colocs |&gt;\n  filter(locus_gene_name == coloc_gene_name) |&gt;\n  mutate(\n    sig_abc_score_gwas = PP.H4.abf_abc_score_gwas &gt; 0.8,\n    sig_unif = PP.H4.abf_unif &gt; 0.8\n  ) |&gt;\n  filter(sig_abc_score_gwas != sig_unif) |&gt;\n  select(eqtl_id, coloc_gene_name,\n         PP.H4.abf_unif, PP.H4.abf_abc_score_gwas)\n\n# A tibble: 5 × 4\n  eqtl_id   coloc_gene_name PP.H4.abf_unif PP.H4.abf_abc_score_gwas\n  &lt;chr&gt;     &lt;chr&gt;                    &lt;dbl&gt;                    &lt;dbl&gt;\n1 QTD000021 ADCY3                    0.809                    0.778\n2 QTD000341 PSMD5                    0.187                    0.814\n3 QTD000021 CNTRL                    0.696                    0.881\n4 QTD000341 DRD4                     0.838                    0.795\n5 QTD000341 GINS2                    0.749                    0.883\n\n\n\ngwas_eqtl_colocs |&gt;\n  filter(locus_gene_name == coloc_gene_name) |&gt;\n  mutate(\n    sig_gwas_tss_eqtlgen = PP.H4.abf_gwas_tss_eqtlgen &gt; 0.8,\n    sig_unif = PP.H4.abf_unif &gt; 0.8\n  ) |&gt;\n  filter(sig_gwas_tss_eqtlgen != sig_unif) |&gt;\n  select(eqtl_id, coloc_gene_name,\n         PP.H4.abf_unif, PP.H4.abf_gwas_tss_eqtlgen)\n\n# A tibble: 6 × 4\n  eqtl_id   coloc_gene_name PP.H4.abf_unif PP.H4.abf_gwas_tss_eqtlgen\n  &lt;chr&gt;     &lt;chr&gt;                    &lt;dbl&gt;                      &lt;dbl&gt;\n1 QTD000373 SLC66A1                  0.686                      0.937\n2 QTD000341 SLC66A1                  0.789                      0.940\n3 QTD000499 NEMP2                    0.486                      0.819\n4 QTD000021 ADCY3                    0.809                      0.664\n5 QTD000021 CNTRL                    0.696                      0.854\n6 QTD000341 GINS2                    0.749                      0.846\n\n\n\ngwas_eqtl_colocs |&gt;\n  filter(locus_gene_name == \"GINS2\") |&gt;\n  filter(locus_gene_name == coloc_gene_name) |&gt;\n  select(eqtl_id, coloc_gene_name, \n        PP.H4.abf_unif, PP.H4.abf_abc_score_gwas)\n\n# A tibble: 3 × 4\n  eqtl_id   coloc_gene_name PP.H4.abf_unif PP.H4.abf_abc_score_gwas\n  &lt;chr&gt;     &lt;chr&gt;                    &lt;dbl&gt;                    &lt;dbl&gt;\n1 QTD000373 GINS2                    0.808                    0.892\n2 QTD000341 GINS2                    0.749                    0.883\n3 QTD000499 GINS2                    0.890                    0.975\n\n\n\ngwas_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_abc_score_gwas)) + \n  geom_point() + \n  geom_hline(yintercept = 0.8, col = \"red\") + \n  geom_vline(xintercept = 0.8, col = \"red\") + \n  theme_bw()\n\n\n\n\n\ngwas_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_gwas_tss_eqtlgen)) + \n  geom_point() + \n  geom_abline(linetype = \"dotted\") + \n  geom_hline(yintercept = 0.8, col = \"red\") + \n  geom_vline(xintercept = 0.8, col = \"red\") + \n  theme_bw()"
  },
  {
    "objectID": "prior-visualisation.html",
    "href": "prior-visualisation.html",
    "title": "Prior estimation",
    "section": "",
    "text": "renv::load(\"..\")\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(patchwork)\nlibrary(tidyr)\nlibrary(seqminer)\n\nsource(here::here(\"code/coloc-utils.R\"))\ndevtools::load_all(\"~/coloc\")\n\n\ngnocchi_data &lt;- read_tsv(here::here(\"data/gnocchi-windows.bed\"),\n                         col_names = FALSE, show_col_types = FALSE)\ncolnames(gnocchi_data) &lt;- c(\"chromosome\", \"start_pos\", \"end_pos\", \"score\")\n\nabc_score_data &lt;- read_tsv(here::here(\"data/abc-score-data.txt.gz\"), show_col_types = FALSE)\n\ndensity_data_round_1 &lt;- read_rds(here::here(\"output/densities/onek1k_cd4nc_round_1.rds\"))\ndensity_data_round_2 &lt;- read_rds(here::here(\"output/densities/onek1k_cd4nc_round_2.rds\"))\ndensity_data_round_3 &lt;- read_rds(here::here(\"output/densities/onek1k_cd4nc_round_3.rds\"))\neqtlgen_density_data &lt;- read_rds(here::here(\"output/densities/eqtlgen.rds\"))\n\nsnp_var_data_1_7 &lt;- read_parquet(here::here(\"data/snpvar_meta.chr1_7.parquet\"))\n\nchr &lt;- 1\ntss &lt;- 113871759\ngene_name &lt;- \"PTPN22\"\n\nposition &lt;- tabix.read.table(here::here(\"data/T1D_Chiou_34012112_1-hg38.tsv.gz\"), \"1:1-2147483647\") |&gt; \n  as_tibble() |&gt;\n  rename(\n    rsid = SNPID,\n    chromosome = CHR38,\n    position = BP38,\n    beta = BETA,\n    se = SE,\n    maf = ALT_FREQ\n  ) |&gt;\n  mutate(\n    an = 2 * sample_size,\n    molecular_trait_id = \"t1d\",\n    variant = paste0(\"chr\", chromosome, \"_\", position, \"_\", REF, \"_\", ALT)\n  ) |&gt;\n  select(-c(sample_size, REF, ALT)) |&gt;\n    filter(chromosome == chr) |&gt;\n    filter(\n      position &lt;= tss + 100000 &\n      position &gt;= tss - 100000\n  ) |&gt;\n  prepare_coloc_dataset() |&gt;\n  pull(position)\n\n\neqtl_prior_weights_eqtlgen &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, eqtlgen_density_data\n)\neqtl_prior_weights &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, density_data_round_1\n)\neqtl_prior_weights_round_2 &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, density_data_round_2\n)\neqtl_prior_weights_round_3 &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, density_data_round_3\n)\ngnocchi_prior_weights &lt;- compute_gnocchi_prior_weights(\n  position, chr, gnocchi_data\n)\nabc_score_prior_weights &lt;- compute_abc_prior_weights(\n  position, chr, gene_name, abc_score_data\n)\n\nWarning: replacing previous import 'S4Arrays::makeNindexFromArrayViewport' by\n'DelayedArray::makeNindexFromArrayViewport' when loading 'SummarizedExperiment'\n\nabc_score_primary_blood_prior_weights &lt;- compute_abc_prior_weights(\n  position, chr, gene_name, abc_score_data,\n  biosamples = \"primary_blood\"\n)\npolyfun_prior_weights &lt;- compute_polyfun_prior_weights(\n  position, chr, snp_var_data_1_7\n)\n\n\ntibble(\n  position = position, \n  eqtlgen = eqtl_prior_weights_eqtlgen,\n  onek1k_round_1 = eqtl_prior_weights,\n  onek1k_round_2 = eqtl_prior_weights_round_2,\n  onek1k_round_3 = eqtl_prior_weights_round_3 \n) |&gt;\n  pivot_longer(cols = -position, names_to = \"type\",\n               values_to = \"weight\") |&gt;\n  ggplot(aes(position, weight)) + \n  geom_point() + \n  facet_wrap(~type) + \n  theme_bw()\n\n\n\n\n\ntibble(\n  position = position, \n  abc_score_all = abc_score_prior_weights,\n  abc_score_primary_blood = abc_score_primary_blood_prior_weights,\n  gnocchi = gnocchi_prior_weights,\n  polyfun = polyfun_prior_weights\n) |&gt;\n  pivot_longer(cols = -position, names_to = \"type\",\n               values_to = \"weight\") |&gt;\n  ggplot(aes(position, weight)) + \n  geom_point() + \n  facet_wrap(~type, scales = \"free\") + \n  theme_bw()"
  },
  {
    "objectID": "simulation-analysis.html",
    "href": "simulation-analysis.html",
    "title": "Simulation analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(dplyr)\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(glue)\n\n\nlocus &lt;- c(\"PTPN22\", \"IL21\", \"IRF5\")\nsimulation_data &lt;- lapply(locus, function(x) {\n  here::here(glue(\"output/data/sim-result-{x}.rds\")) |&gt;\n  read_rds() |&gt;\n  mutate(locus = x)\n}) |&gt;\n  bind_rows()\n\n\nsimulation_data |&gt;\n  mutate(\n    fp = hyp == \"h3\" & pp_h4 &gt;= 0.8,\n    tp = hyp == \"h4\" & pp_h4 &gt;= 0.8,\n    fn = hyp == \"h4\" & pp_h4 &lt; 0.8\n  ) |&gt;\n  summarise(\n    n_tp = sum(tp),\n    n_fn = sum(fn), \n    n_fp = sum(fp),\n    .by = prior\n  ) |&gt;\n  mutate(\n    recall = n_tp / (n_tp + n_fn),\n    precision = n_tp / (n_tp + n_fp)\n  )\n\n# A tibble: 2 × 6\n  prior     n_tp  n_fn  n_fp recall precision\n  &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;\n1 unif       125    25    14  0.833     0.899\n2 non_unif   124    26    12  0.827     0.912\n\n\n\nsimulation_data |&gt;\n  ggplot(aes(hyp, pp_h4, fill = prior)) + \n  geom_boxplot(position = \"dodge\") + \n  geom_hline(yintercept = 0.8, linetype = \"dashed\") +\n  theme_bw() + \n  labs(\n    x = \"True hypothesis\", \n    y = \"Mean Pr(H4)\",\n    fill = \"Prior type\"\n  )\n\n\n\n\n\nsimulation_data |&gt;\n  ggplot(aes(hyp, pp_h4, fill = prior)) +\n  geom_boxplot(position = \"dodge\") +\n  geom_hline(yintercept = 0.8, linetype = \"dashed\") +\n  theme_bw() +\n  labs(\n    x = \"True hypothesis\",\n    y = \"Mean Pr(H4)\",\n    fill = \"Prior type\"\n  ) +\n  facet_wrap(~locus)"
  }
]