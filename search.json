[
  {
    "objectID": "eqtl-tss-distance-analysis.html",
    "href": "eqtl-tss-distance-analysis.html",
    "title": "eQTL distribution analysis",
    "section": "",
    "text": "library(readr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(tools)\nlibrary(forcats)\nlibrary(janitor)\nlibrary(ggupset)\nlibrary(purrr)\nlibrary(dplyr, warn.conflicts = FALSE)\n\nsource(here::here(\"code\", \"plot-utils.R\"))\n\nconflicted::conflict_prefer(\"select\", \"dplyr\")\nconflicted::conflict_prefer(\"filter\", \"dplyr\")\neqtl_catalogue_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"eqtl-catalogue.rds\"))\ngtex_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"gtex.rds\"))\nadipos_express_marignal_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"adipos-express-marginal.rds\"))\neqtlgen_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"eqtlgen.rds\"))\nonek1k_data &lt;- readRDS(here::here(\"data\", \"processed-data\", \"onek1k.rds\"))"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#eqtl-catalouge",
    "href": "eqtl-tss-distance-analysis.html#eqtl-catalouge",
    "title": "eQTL distribution analysis",
    "section": "eQTL catalouge",
    "text": "eQTL catalouge\n\neqtl_catalogue_data |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(file, abs_tss_distance, fill = study_label)) +\n  geom_boxplot(outlier.alpha = 0.1) +\n  coord_flip() +\n  labs(\n    x = \"eQTL catalogue datasets\",\n    y = \"Distance from the TSS (bp)\",\n    fill = \"Study\"\n  ) +\n  theme_jp_vgrid() + \n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        legend.position = \"right\", \n        legend.text = element_text(size = 14))\n\nWarning: Removed 18 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\neqtl_catalogue_data |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  summarise(abs_tss_distance = median(abs_tss_distance), \n            .by = c(file, sample_size, study_label)) |&gt;\n  ggplot(aes(sample_size, abs_tss_distance, colour = study_label)) +\n  geom_point(size = 3) +\n  labs(\n    x = \"Study sample size\",\n    y = \"Median distance to TSS\", \n    colour = \"Study\"\n  ) +\n  theme_jp() + \n  theme(axis.text = element_text(size = 10), \n        legend.position = \"right\", \n        legend.text = element_text(size = 14))"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#gtex",
    "href": "eqtl-tss-distance-analysis.html#gtex",
    "title": "eQTL distribution analysis",
    "section": "GTEx",
    "text": "GTEx\n\ngtex_data |&gt;\n  mutate(tissue = fct_rev(factor(tissue))) |&gt;\n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;  \n  ggplot(aes(tissue, abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Tissue\",\n    y = \"Distance to TSS\"\n  ) +\n  coord_flip() +\n  theme_jp_vgrid() + \n  theme(axis.text = element_text(size = 8))\n\nWarning: Removed 56 rows containing non-finite values (`stat_boxplot()`)."
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#adipoexpress-marginal",
    "href": "eqtl-tss-distance-analysis.html#adipoexpress-marginal",
    "title": "eQTL distribution analysis",
    "section": "AdipoExpress marginal",
    "text": "AdipoExpress marginal\n\nadipos_express_marignal_data |&gt; \n  ggplot(aes(file, abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Chromosome\",\n    y = \"Distance to TSS\"\n  ) +\n  coord_flip() +\n  theme_bw()"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#onek1k",
    "href": "eqtl-tss-distance-analysis.html#onek1k",
    "title": "eQTL distribution analysis",
    "section": "Onek1k",
    "text": "Onek1k\n\nBy combination of cell types\n\ncombination_onek1k_data &lt;- onek1k_data |&gt; \n  summarise(cell_type_collapsed = paste0(sort(unlist(cell_type)), collapse=\"-\"),\n            .by = c(gene_id, abs_tss_distance, round))\n\nmost_common_cell_types &lt;- combination_onek1k_data |&gt; \n  count(cell_type_collapsed) |&gt; \n  arrange(desc(n)) |&gt; \n  slice_head(n = 30) |&gt; \n  pull(cell_type_collapsed)\n\nsingle_cell_types &lt;- keep(most_common_cell_types, \n                          \\(x) !grepl(\"-\", x, fixed = TRUE))\n\ncombination_onek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  filter(cell_type_collapsed %in% most_common_cell_types) |&gt; \n  mutate(cell_type_collapsed = fct_reorder(\n    factor(cell_type_collapsed), \n    abs_tss_distance, \n    .desc = TRUE)\n  ) |&gt; \n  ggplot(aes(x = cell_type_collapsed, y = abs_tss_distance)) +\n  geom_boxplot() + \n  axis_combmatrix(sep = \"-\", levels = single_cell_types) + \n  labs(\n    x = \"\", \n    y = \"log(10) abs tss distance\"\n  ) + \n  theme_jp() + \n  theme(axis.text = element_text(size = 12), \n        axis.title.y = element_text(vjust=-30))\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\n\nBy individual cell type\n\nonek1k_data |&gt; \n  filter(n_cell_types == 1) |&gt; \n  mutate(cell_type = unlist(cell_type)) |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;\n  mutate(cell_type = fct_reorder(factor(cell_type), abs_tss_distance)) |&gt; \n  ggplot(aes(cell_type, abs_tss_distance)) + \n  geom_boxplot() + \n  coord_flip() + \n  labs(\n    y = \"Distance\", \n    x = \"Cell type\"\n  ) +\n  theme_jp_vgrid() + \n  theme(axis.text = element_text(size = 10))\n\n\n\n\n\n\nBy number of cell types for eQTL\n\nonek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt;\n  ggplot(aes(factor(n_cell_types), abs_tss_distance)) +\n  geom_boxplot(outlier.alpha = 0.1) +\n  labs(\n    x = \"Number of cell types with eQTL\",\n    y = \"Distance of eQTL SNP to eGene TSS (log10 bp)\",\n  ) +\n  theme_jp()\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data |&gt; \n  ggplot(aes(factor(n_cell_types))) +\n  geom_bar() +\n  labs(\n    x = \"Number of cell types with eQTL\",\n    y = \"Number of eQTL-eGene pairs\",\n  ) +\n  theme_jp()\n\n\n\n\n\n\nBy round of conditional analysis\n\nonek1k_data |&gt; \n  mutate(abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(factor(round), abs_tss_distance)) +\n  geom_boxplot(fill = \"grey\", outlier.alpha = 0.1) +\n  labs(\n    x = \"Round of conditional analysis\",\n    y = \"Distance of eQTL variant to eGene TSS (log10 bp)\",\n  ) +\n  theme_jp()\n\nWarning: Removed 1 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data |&gt; \n  ggplot(aes(factor(round))) +\n  geom_bar() +\n  labs(\n    x = \"Round\",\n    y = \"Number of eQTL-eGene pairs\",\n  ) +\n  theme_jp()"
  },
  {
    "objectID": "eqtl-tss-distance-analysis.html#across-studies",
    "href": "eqtl-tss-distance-analysis.html#across-studies",
    "title": "eQTL distribution analysis",
    "section": "Across studies",
    "text": "Across studies\n\nbind_rows(\n  gtex_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"GTX v8\"),\n  eqtlgen_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"eQTLGen\"),\n  eqtl_catalogue_data |&gt;\n    select(abs_tss_distance) |&gt;\n    mutate(study = \"eQTL Catalogue\"),\n  adipos_express_marignal_data |&gt; \n    select(abs_tss_distance) |&gt; \n    mutate(study = \"AdiposExpress\\n (Marginal)\"),\n  onek1k_data |&gt; \n    filter(round == 1) |&gt;\n    select(abs_tss_distance) |&gt; \n    mutate(study = \"OneK1K\")\n) |&gt;\n  mutate(log10_abs_tss_distance = log10(abs_tss_distance)) |&gt; \n  ggplot(aes(study, log10_abs_tss_distance)) +\n  geom_violin(fill = \"grey\") +\n  geom_boxplot(outlier.alpha = 0.1) +\n  labs(\n    x = \"Study\",\n    y = \"Absolute Log(10) distance from variant to TSS\",\n  ) +\n  coord_flip() +\n  theme_jp_vgrid()\n\nWarning: Removed 76 rows containing non-finite values (`stat_ydensity()`).\n\n\nWarning: Removed 76 rows containing non-finite values (`stat_boxplot()`).\n\n\n\n\n\n\nonek1k_data\n\n# A tibble: 6,749 × 9\n   gene_id         tss_distance round cell_type_collapsed cell_type n_cell_types\n   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;list&gt;           &lt;int&gt;\n 1 ENSG00000001561      -30457      1 Natural Killer Cell &lt;chr [1]&gt;            1\n 2 ENSG00000001561      731144      2 Dendritic Cell      &lt;chr [1]&gt;            1\n 3 ENSG00000002549       -6032.     1 Classic Monocyte    &lt;chr [1]&gt;            1\n 4 ENSG00000002549        5396.     1 Non-classic Monocy… &lt;chr [1]&gt;            1\n 5 ENSG00000002822     -307020      1 CD8 Effector memory &lt;chr [1]&gt;            1\n 6 ENSG00000002822     -243222      1 Non-classic Monocy… &lt;chr [1]&gt;            1\n 7 ENSG00000002822     -195349      1 Natural Killer Cell &lt;chr [1]&gt;            1\n 8 ENSG00000002919      -32379      1 CD8 Effector memory &lt;chr [1]&gt;            1\n 9 ENSG00000002933      -21895      1 Non-classic Monocy… &lt;chr [1]&gt;            1\n10 ENSG00000002933      -21895      2 Dendritic Cell      &lt;chr [1]&gt;            1\n# ℹ 6,739 more rows\n# ℹ 3 more variables: abs_tss_distance &lt;dbl&gt;, log10_tss_distance &lt;dbl&gt;,\n#   log10_abs_tss_distance &lt;dbl&gt;\n\nonek1k_data |&gt; \n  filter(abs(tss_distance) &lt;= 150000) |&gt; \n  ggplot(aes(tss_distance)) + \n  geom_density(bw = \"SJ\") + \n  facet_wrap(~ round) \n\n\n\n\n\ndens &lt;- eqtlgen_data |&gt; \n  filter(abs(tss_distance) &lt;= 300000) |&gt; \n  pull(tss_distance) |&gt; \n  density(bw = \"SJ\")\n  \ndens_data &lt;- tibble(x = dens$x, y = dens$y)\n\nsaveRDS(dens_data, here::here(\"output\", \"data\", \"density.rds\"))\n\n\nlog10_dens &lt;- eqtlgen_data |&gt; \n  filter(log10_abs_tss_distance &lt;= log10(300000)) |&gt; \n  filter(log10_abs_tss_distance &gt; 1) |&gt; \n  pull(log10_abs_tss_distance) |&gt; \n  density(bw = \"SJ\")\n\n\nall_studies_data &lt;- bind_rows(\n gtex_data |&gt;\n    mutate(study = \"GTX v8\"),\n  eqtlgen_data |&gt;\n    mutate(study = \"eQTLGen\"),\n  eqtl_catalogue_data |&gt;\n    mutate(study = \"eQTL Catalogue\"),\n  onek1k_data |&gt; \n    filter(round == 1) |&gt;\n    mutate(study = \"OneK1K\")\n)\n\n\nall_studies_data |&gt; \n  filter(abs(tss_distance) &lt;= 100000) |&gt; \n  mutate(kb = tss_distance / 1000) |&gt; \n  ggplot(aes(kb)) + \n  geom_density(bw = \"SJ\") + \n  facet_wrap(~ study, scales = \"free_y\") + \n  theme_jp() + \n  labs(\n    y = \"\",\n    x = \"Distance to TSS (kb)\"\n  ) + \n  theme(\n    axis.text = element_text(size = 12), \n    axis.title = element_text(size = 16),\n    strip.text = element_text(size = 20, hjust = 0)\n  )"
  },
  {
    "objectID": "pqtl-eqtl-coloc-analysis.html",
    "href": "pqtl-eqtl-coloc-analysis.html",
    "title": "pQTL-eQTL colocalisation analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(purrr)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(patchwork)\nlibrary(yaml)\nlibrary(forcats)\n\ndevtools::load_all(\"~/coloc\")\n\n\n# Load eQTL dataset IDs.\nconfig &lt;- read_yaml(here::here(\"config.yaml\"))\neqtl_data_ids &lt;- config$pqtl_eqtl_coloc_dataset_ids\neqtl_data_ids_lookup &lt;- c(\n  \"QTD000373\" = \"Lepik et. al. 2017\",\n  \"QTD000341\" = \"GTEx thyroid\",\n  \"QTD000116\" = \"GTEx adipose (subcutaneous)\",\n  \"QTD000021\" = \"BLUEPRINT Monocytes\",\n  \"QTD000539\" = \"TwinsUK LCL\"\n)\n\n# Load eQTL-pQTL colocalisation results.\npqtl_eqtl_colocs &lt;- expand_grid(\n  eqtl_data_id = eqtl_data_ids, \n  chr = 1:22\n) |&gt;\n  rowwise() |&gt;\n  mutate(file = paste0(\n    here::here(\"output/data/pqtl-eqtl-coloc\"), \"-\", eqtl_data_id, \"-\", chr, \".rds\")\n  ) |&gt;\n  mutate(data = list(read_rds(file))) |&gt;\n  unnest(data)\n\n# Load protein metadata.\nprotein_metadata &lt;- read_tsv(\n  here::here(\"data/metadata/SomaLogic_Ensembl_96_phenotype_metadata.tsv.gz\"), \n  show_col_types = FALSE\n)\n\n\ncoloc_level_data &lt;- left_join(\n  pqtl_eqtl_colocs |&gt;\n    select(eqtl_data_id, starts_with(\"PP.H4.abf\"), phenotype_id, \n           coloc_gene_id = gene_id), \n  protein_metadata |&gt;\n    select(coding_gene_id = gene_id, phenotype_id),\n  by = \"phenotype_id\"\n) |&gt;\n  rename(protein_id = phenotype_id) |&gt;\n  pivot_longer(-c(protein_id, coding_gene_id, eqtl_data_id, coloc_gene_id),\n               values_to = \"pp_h4\", \n               names_to = c(\"junk\", \"prior_type\"),\n               names_pattern = \"(.*?)_(.*)\") |&gt;\n  select(-junk) |&gt;\n  mutate(sig_coloc = pp_h4 &gt;= 0.8) |&gt;\n  mutate(gene_match = coding_gene_id == coloc_gene_id) |&gt;\n  summarise(\n    colocalised = any(sig_coloc), \n    is_tp = any(sig_coloc & gene_match),\n    is_fn = !any(sig_coloc & gene_match),\n    is_fp = any(sig_coloc) & !any(sig_coloc & gene_match),\n    .by = c(protein_id, prior_type, eqtl_data_id)\n  ) |&gt;\n  # FIXME: Monocyte issues with ABC score.\n  summarise(\n    n_colocalised = sum(colocalised, na.rm = TRUE),\n    n_tp = sum(is_tp, na.rm = TRUE),\n    n_fn = sum(is_fn, na.rm = TRUE),\n    n_fp = sum(is_fp, na.rm = TRUE),\n    .by = c(eqtl_data_id, prior_type)\n  ) |&gt;\n  mutate(\n    recall = n_tp / (n_tp + n_fn), \n    precision = n_tp / (n_tp + n_fp)\n  )\n\nprotein_level_data &lt;- left_join(\n  pqtl_eqtl_colocs |&gt;\n    select(eqtl_data_id, starts_with(\"PP.H4.abf\"), phenotype_id, \n           coloc_gene_id = gene_id), \n  protein_metadata |&gt;\n    select(coding_gene_id = gene_id, phenotype_id),\n  by = \"phenotype_id\"\n) |&gt;\n  rename(protein_id = phenotype_id) |&gt;\n  pivot_longer(-c(protein_id, coding_gene_id, eqtl_data_id, coloc_gene_id),\n               values_to = \"pp_h4\", \n               names_to = c(\"junk\", \"prior_type\"),\n               names_pattern = \"(.*?)_(.*)\") |&gt;\n  select(-junk) |&gt;\n  mutate(sig_coloc = pp_h4 &gt;= 0.8) |&gt;\n  mutate(gene_match = coding_gene_id == coloc_gene_id) |&gt;\n  summarise(\n    colocalised = any(sig_coloc), \n    is_tp = any(sig_coloc & gene_match),\n    is_fn = !any(sig_coloc & gene_match),\n    is_fp = any(sig_coloc) & !any(sig_coloc & gene_match),\n    .by = c(protein_id, prior_type, eqtl_data_id)\n  ) |&gt;\n  # FIXME: Monocyte issues with ABC score.\n  summarise(\n    n_colocalised = sum(colocalised, na.rm = TRUE),\n    n_tp = sum(is_tp, na.rm = TRUE),\n    n_fn = sum(is_fn, na.rm = TRUE),\n    n_fp = sum(is_fp, na.rm = TRUE),\n    .by = c(eqtl_data_id, prior_type)\n  ) |&gt; \n  mutate(\n    recall = n_tp / (n_tp + n_fn), \n    precision = n_tp / (n_tp + n_fp)\n  )\n\n\ncoloc_level_data\n\n# A tibble: 80 × 8\n   eqtl_data_id prior_type      n_colocalised  n_tp  n_fn  n_fp recall precision\n   &lt;chr&gt;        &lt;chr&gt;                   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;\n 1 QTD000373    unif                      128    90   444    38  0.169     0.703\n 2 QTD000373    eqtl_tss_onek1…           128    88   446    40  0.165     0.688\n 3 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 4 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 5 QTD000373    pqtl_tss_onek1…           133    92   442    41  0.172     0.692\n 6 QTD000373    eqtl_tss_pqtl_…           133    91   443    42  0.170     0.684\n 7 QTD000373    eqtl_tss_eqtlg…           127    87   447    40  0.163     0.685\n 8 QTD000373    pqtl_tss_eqtlg…           132    93   441    39  0.174     0.705\n 9 QTD000373    eqtl_tss_pqtl_…           132    90   444    42  0.169     0.682\n10 QTD000373    gnocchi_eqtl              127    88   446    39  0.165     0.693\n# ℹ 70 more rows\n\n\n\nprotein_level_data\n\n# A tibble: 80 × 8\n   eqtl_data_id prior_type      n_colocalised  n_tp  n_fn  n_fp recall precision\n   &lt;chr&gt;        &lt;chr&gt;                   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;\n 1 QTD000373    unif                      128    90   444    38  0.169     0.703\n 2 QTD000373    eqtl_tss_onek1…           128    88   446    40  0.165     0.688\n 3 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 4 QTD000373    eqtl_tss_onek1…           127    87   447    40  0.163     0.685\n 5 QTD000373    pqtl_tss_onek1…           133    92   442    41  0.172     0.692\n 6 QTD000373    eqtl_tss_pqtl_…           133    91   443    42  0.170     0.684\n 7 QTD000373    eqtl_tss_eqtlg…           127    87   447    40  0.163     0.685\n 8 QTD000373    pqtl_tss_eqtlg…           132    93   441    39  0.174     0.705\n 9 QTD000373    eqtl_tss_pqtl_…           132    90   444    42  0.169     0.682\n10 QTD000373    gnocchi_eqtl              127    88   446    39  0.165     0.693\n# ℹ 70 more rows\n\n\n\ncoloc_level_data |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  mutate(eqtl_data_name = eqtl_data_ids_lookup[eqtl_data_id]) |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n  ) + \n  facet_wrap(~eqtl_data_name, scales = \"free\") + \n  theme_bw() + \n  theme(legend.position = \"none\")\n\nWarning: ggrepel: 7 unlabeled data points (too many overlaps). Consider increasing max.overlaps\nggrepel: 7 unlabeled data points (too many overlaps). Consider increasing max.overlaps\n\n\nWarning: ggrepel: 10 unlabeled data points (too many overlaps). Consider increasing max.overlaps\nggrepel: 10 unlabeled data points (too many overlaps). Consider increasing max.overlaps\n\n\nWarning: ggrepel: 9 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\ncoloc_level_data |&gt;\n  filter(eqtl_data_id == \"QTD000021\") |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n  ) + \n  theme_bw() + \n  theme(legend.position = \"none\")\n\n\n\n\n\ncoloc_level_data |&gt;\n  summarise(\n    recall = median(recall), \n    precision = median(precision), \n    .by = prior_type\n  ) |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n    title = \"Median over eQTL datasets\"\n  ) + \n  theme_bw() + \n  theme(legend.position= \"none\")\n\n\n\n\n\ncoloc_level_data |&gt;\n  mutate(eqtl_data_name = eqtl_data_ids_lookup[eqtl_data_id]) |&gt;\n  mutate(prior_type = fct_reorder(\n    factor(prior_type), \n    n_colocalised)\n  ) |&gt;\n  mutate(eqtl_data_name = fct_reorder(\n    factor(eqtl_data_name), \n    n_colocalised\n  )) |&gt;\n  ggplot(aes(prior_type, n_colocalised, fill = eqtl_data_name)) + \n  geom_col(position = \"dodge\") + \n  coord_flip() + \n  labs(\n    y = \"Number of signigicantly colocalised pQTL-eQTL pairs\",\n    x = \"Prior\"\n  ) + \n  theme_bw()\n\n\n\n\n\nprotein_level_data |&gt;\n  mutate(is_unif = prior_type == \"unif\") |&gt;\n  ggplot(aes(recall, precision, col = is_unif, label = prior_type)) + \n  geom_point() + \n  geom_label_repel() + \n  labs(\n    x = \"Recall\", \n    y = \"Precision\",\n  ) + \n  guides(col = \"none\") + \n  theme_bw()\n\nWarning: ggrepel: 67 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_eqtl_tss_eqtlgen)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw() + \npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_pqtl_tss_eqtlgen)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw()\n\n\n\n\n\npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_abc_score_eqtl)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw() + \npqtl_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_abc_score_pqtl)) + \n  geom_point() + \n  geom_vline(xintercept = 0.8, colour = \"red\") + \n  geom_hline(yintercept = 0.8, colour = \"red\") + \n  theme_bw()\n\nWarning: Removed 5 rows containing missing values (`geom_point()`).\nRemoved 5 rows containing missing values (`geom_point()`).\n\n\n\n\n\nNo trend in which Pr(H4) are affected\n\npqtl_eqtl_colocs |&gt;\n  mutate(diff = PP.H4.abf_unif - PP.H4.abf_abc_score_pqtl) |&gt;\n  ggplot(aes(PP.H4.abf_unif , diff)) + \n  geom_point() + \n  coord_cartesian(ylim = c(-0.75, 0.75)) + \n  theme_bw()\n\nWarning: Removed 5 rows containing missing values (`geom_point()`).\n\n\n\n\n\nIn most cases adding the prior has little effect\n\npqtl_eqtl_colocs |&gt;\n  mutate(diff = abs(PP.H4.abf_unif - PP.H4.abf_abc_score_pqtl)) |&gt;\n  mutate(cut_diff = cut(diff, breaks = seq(0, 1, by = 0.05), \n                        include.lowest = TRUE)) |&gt;\n  count(cut_diff) |&gt;\n  mutate(prop = n / sum(n)) |&gt;\n  ggplot(aes(cut_diff, prop)) + \n  geom_col() + \n  labs(\n    x = \"Range of difference\", \n    y = \"Proportion\"\n  ) + \n  theme_bw()"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Home",
    "section": "",
    "text": "eQTL TSS distance analysis\nPrior visualisation\nGWAS-eQTL colocalisation analysis\npQTL-eQTL colocalisation analysis\nFine-mapping analysis\nSimulation analysis"
  },
  {
    "objectID": "finemapping-analysis.html",
    "href": "finemapping-analysis.html",
    "title": "Finemapping analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(forcats)\n\ndevtools::load_all(\"~/coloc\")\n\n\ncompute_credible_set &lt;- function(pips, alpha = 0.95) {\n  pips_order &lt;- order(pips, decreasing = TRUE)\n  cum_pips &lt;- cumsum(pips[pips_order])\n  cs_size &lt;- which.max(cum_pips &gt;= alpha) \n  pips_order[1:cs_size]\n}\n\n\ngwas_eqtl_finemapping &lt;- expand_grid(\n  chr = 1:22\n) |&gt;\n  rowwise() |&gt;\n  mutate(file = paste0(\n    here::here(\"output/data/gwas-eqtl-finemapping\"), \"-\", chr, \".rds\")\n  ) |&gt;\n  mutate(data = list(read_rds(file))) |&gt;\n  unnest(data)\n\n\ncs_n_data &lt;- gwas_eqtl_finemapping |&gt;\n  select(gene_name, ends_with(\"eqtl\"), ends_with(\"gwas\")) |&gt;\n  pivot_longer(-gene_name, values_to = \"pip\") |&gt;\n  summarise(cs = list(compute_credible_set(pip)), \n            .by = c(gene_name, name)) |&gt;\n  rowwise() |&gt;\n  mutate(cs_n = length(cs)) |&gt;\n  ungroup()\n\n\ncs_n_data |&gt;\n  mutate(name = fct_reorder(factor(name), cs_n)) |&gt;\n  ggplot(aes(name, log(cs_n))) + \n  geom_boxplot() + \n  coord_flip() +\n  theme_bw()\n\n\n\n\n\ncs_n_data |&gt;\n  mutate(single_cs = cs_n == 1) |&gt;\n  summarise(prop_single_cs = sum(single_cs) / n(), .by = name) |&gt;\n  mutate(name = fct_reorder(factor(name), prop_single_cs)) |&gt;\n  ggplot(aes(name, prop_single_cs)) + \n  geom_point() + \n  coord_flip() +\n  theme_bw()\n\n\n\n\n\ncs_n_data |&gt;\n  filter(cs_n &lt;= 20) |&gt;\n  count(cs_n, name) |&gt;\n  ggplot(aes(cs_n, n)) + \n  geom_col() + \n  labs(\n    y = \"Count\",\n    x = \"Size of single-causal variant CS\"\n  ) + \n  facet_wrap(~name) + \n  theme_bw()"
  },
  {
    "objectID": "gwas-eqtl-coloc-analysis.html",
    "href": "gwas-eqtl-coloc-analysis.html",
    "title": "GWAS-eQTL colocalisation analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(forcats)\n\ndevtools::load_all(\"~/coloc\")\n\n\ngwas_eqtl_colocs &lt;- expand_grid(\n  chr = 1:22\n) |&gt;\n  rowwise() |&gt;\n  mutate(file = paste0(\n    here::here(\"output/data/gwas-eqtl-coloc\"), \"-\", chr, \".rds\")\n  ) |&gt;\n  mutate(data = list(read_rds(file))) |&gt;\n  unnest(data)\n\n\ngwas_eqtl_colocs |&gt;\n  filter(PP.H4.abf_unif &gt;= 0.8) |&gt;\n  select(gene_name) |&gt;\n  print(n = 30)\n\n# A tibble: 24 × 1\n   gene_name\n   &lt;chr&gt;    \n 1 ZNF683   \n 2 UTP11    \n 3 PIK3R3   \n 4 ST7L     \n 5 ELK4     \n 6 RAB29    \n 7 BATF3    \n 8 ANKRD55  \n 9 CAMK4    \n10 SLC22A4  \n11 IER3     \n12 ITGB7    \n13 GPN3     \n14 FAM216A  \n15 CTSH     \n16 ACAP1    \n17 KCTD11   \n18 GSDMB    \n19 ORMDL3   \n20 CD226    \n21 ELL      \n22 PRKD2    \n23 NTN5     \n24 SYNGR1   \n\n\n\ngwas_eqtl_colocs |&gt;\n  select(gene_name, starts_with(\"PP.H4.abf\")) |&gt;\n  pivot_longer(-gene_name, values_to = \"pp_h4\") |&gt;\n  mutate(sig_coloc = pp_h4 &gt; 0.8) |&gt;\n  summarise(n_sig = sum(sig_coloc), .by = name) |&gt;\n  mutate(is_unif = name == \"PP.H4.abf_unif\") |&gt;\n  mutate(name = fct_reorder(factor(name), n_sig)) |&gt;\n  ggplot(aes(name, n_sig, fill = is_unif)) + \n  geom_col() + \n  coord_flip() + \n  theme_bw()\n\n\n\n\n\ngwas_eqtl_colocs |&gt;\n  mutate(\n    sig_abc_score_gwas = PP.H4.abf_abc_score_gwas &gt; 0.8,\n    sig_unif = PP.H4.abf_unif &gt; 0.8\n  ) |&gt;\n  filter(sig_abc_score_gwas != sig_unif) |&gt;\n  select(gene_name, PP.H4.abf_unif , PP.H4.abf_abc_score_gwas)\n\n# A tibble: 4 × 3\n  gene_name PP.H4.abf_unif PP.H4.abf_abc_score_gwas\n  &lt;chr&gt;              &lt;dbl&gt;                    &lt;dbl&gt;\n1 ST7L               0.824                    0.791\n2 NSL1               0.728                    0.816\n3 SLC22A5            0.618                    0.925\n4 RGS14              0.657                    0.805\n\n\n\ngwas_eqtl_colocs |&gt;\n  mutate(\n    sig_gwas_tss_eqtlgen = PP.H4.abf_gwas_tss_eqtlgen &gt; 0.8,\n    sig_unif = PP.H4.abf_unif &gt; 0.8\n  ) |&gt;\n  filter(sig_gwas_tss_eqtlgen != sig_unif) |&gt;\n  select(gene_name, PP.H4.abf_unif , PP.H4.abf_gwas_tss_eqtlgen)\n\n# A tibble: 6 × 3\n  gene_name PP.H4.abf_unif PP.H4.abf_gwas_tss_eqtlgen\n  &lt;chr&gt;              &lt;dbl&gt;                      &lt;dbl&gt;\n1 ST7L               0.824                      0.683\n2 NSL1               0.728                      0.859\n3 SLC22A5            0.618                      0.881\n4 RGS14              0.657                      0.825\n5 CLN3               0.787                      0.853\n6 LRRC25             0.522                      0.804\n\n\n\ngwas_eqtl_colocs |&gt;\n  ggplot(aes(PP.H4.abf_unif, PP.H4.abf_abc_score_gwas)) + \n  geom_point() + \n  geom_abline(linetype = \"dotted\") + \n  geom_hline(yintercept = 0.8, col = \"red\") + \n  geom_vline(xintercept = 0.8, col = \"red\") + \n  theme_bw()"
  },
  {
    "objectID": "prior-visualisation.html",
    "href": "prior-visualisation.html",
    "title": "Prior estimation",
    "section": "",
    "text": "renv::load(\"..\")\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(patchwork)\nlibrary(tidyr)\nlibrary(seqminer)\n\nsource(here::here(\"code/coloc-utils.R\"))\ndevtools::load_all(\"~/coloc\")\n\n\ngnocchi_data &lt;- read_tsv(here::here(\"data/gnocchi-windows.bed\"),\n                         col_names = FALSE, show_col_types = FALSE)\ncolnames(gnocchi_data) &lt;- c(\"chromosome\", \"start_pos\", \"end_pos\", \"score\")\n\nabc_score_data &lt;- read_tsv(here::here(\"data/abc-score-data.txt.gz\"), show_col_types = FALSE)\n\ndensity_data_round_1 &lt;- read_rds(here::here(\"output/densities/onek1k_cd4nc_round_1.rds\"))\ndensity_data_round_2 &lt;- read_rds(here::here(\"output/densities/onek1k_cd4nc_round_2.rds\"))\ndensity_data_round_3 &lt;- read_rds(here::here(\"output/densities/onek1k_cd4nc_round_3.rds\"))\neqtlgen_density_data &lt;- read_rds(here::here(\"output/densities/eqtlgen.rds\"))\n\nsnp_var_data_1_7 &lt;- read_parquet(here::here(\"data/snpvar_meta.chr1_7.parquet\"))\n\nchr &lt;- 1\ntss &lt;- 113871759\ngene_name &lt;- \"PTPN22\"\n\nposition &lt;- tabix.read.table(here::here(\"data/T1D_Chiou_34012112_1-hg38.tsv.gz\"), \"1:1-2147483647\") |&gt; \n  as_tibble() |&gt;\n  rename(\n    rsid = SNPID,\n    chromosome = CHR38,\n    position = BP38,\n    beta = BETA,\n    se = SE,\n    maf = ALT_FREQ\n  ) |&gt;\n  mutate(\n    an = 2 * sample_size,\n    molecular_trait_id = \"t1d\",\n    variant = paste0(\"chr\", chromosome, \"_\", position, \"_\", REF, \"_\", ALT)\n  ) |&gt;\n  select(-c(sample_size, REF, ALT)) |&gt;\n    filter(chromosome == chr) |&gt;\n    filter(\n      position &lt;= tss + 100000 &\n      position &gt;= tss - 100000\n  ) |&gt;\n  prepare_coloc_dataset() |&gt;\n  pull(position)\n\n\neqtl_prior_weights_eqtlgen &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, eqtlgen_density_data\n)\neqtl_prior_weights &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, density_data_round_1\n)\neqtl_prior_weights_round_2 &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, density_data_round_2\n)\neqtl_prior_weights_round_3 &lt;- compute_eqtl_tss_dist_prior_weights(\n  position, tss, density_data_round_3\n)\ngnocchi_prior_weights &lt;- compute_gnocchi_prior_weights(\n  position, chr, gnocchi_data\n)\nabc_score_prior_weights &lt;- compute_abc_prior_weights(\n  position, chr, gene_name, abc_score_data\n)\n\nWarning: replacing previous import 'S4Arrays::makeNindexFromArrayViewport' by\n'DelayedArray::makeNindexFromArrayViewport' when loading 'SummarizedExperiment'\n\nabc_score_primary_blood_prior_weights &lt;- compute_abc_prior_weights(\n  position, chr, gene_name, abc_score_data,\n  biosamples = \"primary_blood\"\n)\npolyfun_prior_weights &lt;- compute_polyfun_prior_weights(\n  position, chr, snp_var_data_1_7\n)\n\n\ntibble(\n  position = position, \n  eqtlgen = eqtl_prior_weights_eqtlgen,\n  onek1k_round_1 = eqtl_prior_weights,\n  onek1k_round_2 = eqtl_prior_weights_round_2,\n  onek1k_round_3 = eqtl_prior_weights_round_3 \n) |&gt;\n  pivot_longer(cols = -position, names_to = \"type\",\n               values_to = \"weight\") |&gt;\n  ggplot(aes(position, weight)) + \n  geom_point() + \n  facet_wrap(~type) + \n  theme_bw()\n\n\n\n\n\ntibble(\n  position = position, \n  abc_score_all = abc_score_prior_weights,\n  abc_score_primary_blood = abc_score_primary_blood_prior_weights,\n  gnocchi = gnocchi_prior_weights,\n  polyfun = polyfun_prior_weights\n) |&gt;\n  pivot_longer(cols = -position, names_to = \"type\",\n               values_to = \"weight\") |&gt;\n  ggplot(aes(position, weight)) + \n  geom_point() + \n  facet_wrap(~type, scales = \"free\") + \n  theme_bw()"
  },
  {
    "objectID": "simulation-analysis.html",
    "href": "simulation-analysis.html",
    "title": "Simulation analysis",
    "section": "",
    "text": "renv::load(here::here())\n\n- The project is out-of-sync -- use `renv::status()` for details.\n\nlibrary(dplyr)\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(glue)\n\n\nlocus &lt;- c(\"PTPN22\", \"IL21\", \"IRF5\")\nsimulation_data &lt;- lapply(locus, function(x) {\n  here::here(glue(\"output/data/sim-result-{x}.rds\")) |&gt;\n  read_rds() |&gt;\n  mutate(locus = x)\n}) |&gt;\n  bind_rows()\n\n\nsimulation_data |&gt;\n  mutate(\n    fp = hyp == \"h3\" & pp_h4 &gt;= 0.8,\n    tp = hyp == \"h4\" & pp_h4 &gt;= 0.8,\n    fn = hyp == \"h4\" & pp_h4 &lt; 0.8\n  ) |&gt;\n  summarise(\n    n_tp = sum(tp),\n    n_fn = sum(fn), \n    n_fp = sum(fp),\n    .by = prior\n  ) |&gt;\n  mutate(\n    recall = n_tp / (n_tp + n_fn),\n    precision = n_tp / (n_tp + n_fp)\n  )\n\n# A tibble: 2 × 6\n  prior     n_tp  n_fn  n_fp recall precision\n  &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;\n1 unif       125    25    14  0.833     0.899\n2 non_unif   124    26    12  0.827     0.912\n\n\n\nsimulation_data |&gt;\n  ggplot(aes(hyp, pp_h4, fill = prior)) + \n  geom_boxplot(position = \"dodge\") + \n  geom_hline(yintercept = 0.8, linetype = \"dashed\") +\n  theme_bw() + \n  labs(\n    x = \"True hypothesis\", \n    y = \"Mean Pr(H4)\",\n    fill = \"Prior type\"\n  )\n\n\n\n\n\nsimulation_data |&gt;\n  ggplot(aes(hyp, pp_h4, fill = prior)) +\n  geom_boxplot(position = \"dodge\") +\n  geom_hline(yintercept = 0.8, linetype = \"dashed\") +\n  theme_bw() +\n  labs(\n    x = \"True hypothesis\",\n    y = \"Mean Pr(H4)\",\n    fill = \"Prior type\"\n  ) +\n  facet_wrap(~locus)"
  }
]